{"version":3,"sources":["services/firebase.ts","utils/getRandomFaceEmoji.ts","utils/detectOS.ts","assets/backgroundRipple.svg","services/rtcPeerConnectionConfig.ts","constants/collectionName.ts","constants/sessionStorage.ts","constants/localStorage.ts","constants/numericValues.ts","constants/elementId.ts","providers/IdentityProvider.tsx","styles/breakpoints.ts","styles/styled-components/StyledPeerPosition.tsx","styles/styled-components/StyledPopperContent.tsx","styles/hooks/usePopperStyles.ts","components/Poppers/DropzoneTooltipPopper.tsx","styles/styled-components/StyledCircleButton.tsx","utils/trimName.ts","utils/handleFileRejectedToast.ts","components/DropZone/hooks/useCustomDropzone.ts","components/DropZone/SelfFileDropZone.tsx","components/DropZone/PeerFileDropZone.tsx","styles/styled-components/LinearProgressWithLabel.tsx","providers/AppSettingProvider.tsx","providers/hooks/useTransferSetting.ts","providers/hooks/useAppTheme.ts","components/Poppers/ProgressPopper.tsx","utils/readableBytes.ts","components/Poppers/NotifyOfferPopper.tsx","components/Poppers/WaitResponsePopper.tsx","components/useJoinTransferChannel.ts","components/useCreateTransferChannel.ts","components/PeerConnectionHolder.tsx","components/PeersListener.tsx","styles/theme.ts","styles/hooks/useDrawerStyles.ts","components/SideDrawer/DrawerOptionList.tsx","components/SideDrawer/Modals/JoinRoomModal.tsx","components/SideDrawer/Modals/AboutModal.tsx","components/SideDrawer/index.tsx","IdentityLayout.tsx","styles/styled-components/StyledToastContainer.tsx","App.tsx","serviceWorkerRegistration.ts","reportWebVitals.ts","index.tsx"],"names":["firebase","initializeApp","apiKey","process","authDomain","databaseURL","projectId","storageBucket","messagingSenderId","appId","emojiArr","getRandomFaceEmoji","targetEmoji","i","push","String","fromCodePoint","random","Math","floor","length","splice","detectOS","parsedAgent","Bowser","window","navigator","userAgent","browser","name","platform","type","pcConfig","iceServers","urls","iceCandidatePoolSize","ROOT_COLLECTION","CONNECTIONS","CALLEE","CALLER","FILE_METAS","DATA_CHANNEL_TIMEOUT","WAIT_REMOTE_DESC","PUBLIC_ID","APP_THEME","APP_AUTO_ACCEPT","APP_AUTO_DOWNLOAD","MAXIMUM_FILE_BYTE","ELE_PUBLIC_ID","ELE_PUBLIC_ID_WRAPPER","IdentityContext","React","createContext","localID","publicID","setPublicID","IdentityProvider","children","useState","setLocalID","useEffect","publicIP","channel","pc","RTCPeerConnection","createDataChannel","createOffer","then","offer","setLocalDescription","sessionPublicID","sessionStorage","getItem","onicecandidate","ice","candidate","close","split","btoa","auth","signInAnonymously","uuidv4","catch","toast","error","Provider","value","size","breakpoints","xs","sm","lg","StyledPeerPosition","styled","div","PopperContentWrapper","props","theme","primary","dark","contrastText","ContentTitle","ContentText","ContentBody","ContentFooter","StyledPopperButton","Button","DownloadLinksHolder","StyledDownloadLink","a","secondary","light","usePopperStyles","makeStyles","popper","zIndex","top","left","marginTop","width","height","borderWidth","borderColor","palette","bottom","marginBottom","marginLeft","right","marginRight","arrow","position","fontSize","content","margin","display","borderStyle","DropzoneTooltipPopper","enterType","anchorElement","isSelf","arrowRef","setArrowRef","classes","Popper","open","anchorEl","placement","className","modifiers","flip","enabled","preventOverflow","boundariesElement","element","ref","rippleColor","rgba","normalCircleRipple","keyframes","extendCircleRipple","StyledCircleButton","main","PeerStyledCircleButton","OwnStyledCircleButton","trimName","substring","handleFileRejectedToast","fileRejections","forEach","file","errors","find","code","useCustomDropzone","shouldDisableActionBtn","handleFileInputChange","setEnterType","useDropzone","maxFiles","maxSize","disabled","onDragEnter","onDragLeave","onDropAccepted","onDropRejected","getRootProps","getInputProps","onMouseEnter","onMouseLeave","Wrapper","drawerMinWidth","IdentityWrapper","SelfFileDropZone","selfIdentity","anchorRef","useRef","onClick","document","getElementById","variant","emoji","id","current","PeerFileDropZone","targetPeer","setAnchorElement","onMouseOver","ProgressWrapper","LabelWrapper","LinearProgressWithLabel","max","progress","AppSettingContext","shouldAutoAccept","shouldAutoDownload","appTheme","toggleAutoAccept","toggleAutoDownload","toggleLightDarkTheme","AppSettingProvider","setAutoAccept","setAutoDownload","appAutoAccept","localStorage","appAutoDownload","downloadSetting","setItem","toString","useTransferSetting","setAppTheme","currentTheme","target","useAppTheme","initialProgressPopperData","isOpen","progressType","fileProgress","downloadableFiles","progressPopperReducer","state","action","payload","downloadableFile","ProgressPopper","setClose","onCancelFileTransfer","receivedFiles","setReceivedFiles","handleCancel","handleClose","map","setTimeout","URL","revokeObjectURL","fileBlobUrl","filteredFiles","filter","prevFile","handleDownloadClick","download","fileName","href","color","ConsumedProgressPopper","Consumer","readableBytes","toFixed","log","pow","initialNotifyOfferPopperData","fileMetas","notifyOfferPopperReducer","NotifyOfferPopper","onAcceptFileTransfer","fileMeta","initialWaitResponsePopperData","gotRemoteDesc","waitResponsePopperReducer","WaitResponsePopper","timeoutReload","location","reload","clearTimeout","removeItem","useJoinTransferChannel","firestoreDbRef","connectionIdRef","peerConnectionRef","callerUnsubscriberRef","dispatchProgressPopperData","dispatchWaitResponsePopperData","handleDownloadFile","clearSignalService","receiveChannelRef","closeReceiveDataChannel","useCallback","console","label","createReceiveDataChannel","ondatachannel","event","binaryType","onmessage","onReceiveMessageCallback","onopen","onReceiveChannelStateChange","onclose","connectionRef","collection","doc","completeFlag","receivedSize","targetFileIndex","targetFileSize","receiveBuffer","get","connectionSnapShot","data","byteLength","totalSize","reduce","acc","receivedValue","round","received","Blob","readyState","warn","joinTransferChannel","connectionID","roomRef","connectionSnapshot","exists","calleeCandidatesCollection","addEventListener","add","toJSON","setRemoteDescription","RTCSessionDescription","createAnswer","answer","roomWithAnswer","sdp","isAccepting","update","calllerUnsubscriber","onSnapshot","snapshot","docChanges","change","JSON","stringify","addIceCandidate","RTCIceCandidate","useCreateTransferChannel","calleeUnsubscriberRef","descriptionUnsubscriberRef","totalFileSizeRef","sentFileReaderRef","acceptedFileListRef","sendChannelRef","sendFileData","onTransferSuccess","success","singularOffset","totalOffset","files","maxMessageSize","sctp","chunkSize","FileReader","result","send","sentProgress","checkBufferAmount","bufferedAmount","readSlice","o","slice","nextChunk","readAsArrayBuffer","createSendDataChannel","onSendChannelStateChange","onerror","errorEvent","tryCreatePeerConnection","peer","connectionsRef","targetConnectionRef","p2pData","p2p","callerCandidatesCollection","roomWithOffer","set","descriptionUnsubscriber","currentRemoteDescription","rtcSessionDescription","calleeUnsubscriber","PeerConnectionHolder","sendAllFiles","clearSentAllFiles","isInit","useReducer","waitResponsePopperData","notifyOfferPopperData","dispatchNotifyPopperOfferData","progressPopperData","useMemo","unsubscribe","promptsIncomingFileTransferPopper","connectionId","closeDataChannels","destroyExistingPC","clearFirebaseConnection","delete","receivedBlob","downloadAnchor","createElement","createObjectURL","body","appendChild","click","removeChild","shouldWarn","metas","abort","StyledP","p","$shouldHide","PeersHolder","PeersListener","otherPeers","setOtherPeers","setSendAllFiles","dbRef","firestore","peersRef","database","on","allPeers","val","peerHolder","dismiss","off","noPeer","Grow","in","memo","brightnessTheme","useDrawerStyles","createStyles","hide","drawer","flexShrink","whiteSpace","drawerOpen","transition","transitions","create","easing","sharp","duration","enteringScreen","drawerClose","leavingScreen","overflow","titleText","titleBar","alignItems","justifyContent","StyledListItemIcon","ListItemIcon","StyledListItem","ListItem","$isOpen","StyledList","List","DrawerOptionList","handleJoinRoomModalOpen","handleAboutModalOpen","handleCopyPublicID","e","stopPropagation","clipboard","writeText","info","autoClose","select","Tooltip","title","button","ListItemText","Switch","checked","inputProps","Divider","InputBase","ConsumedDrawerOptionList","StyledDialogActions","DialogActions","allowedCharRegex","RegExp","JoinRoomModal","input","setInput","Dialog","onClose","DialogTitle","DialogContent","DialogContentText","TextField","onChange","targetInput","test","autoFocus","fullWidth","trim","CustomLabel","AboutModal","Link","rel","StyledIconButton","IconButton","StyledDrawer","Drawer","SideDrawer","gestureDirection","contextProps","setDrawerOpen","joinRoomModalOpen","setJoinRoomModalOpen","aboutModalOpen","setAboutModalOpen","clsx","paper","disableRipple","prev","ConsumedSideDrawer","appSettingContext","Loader","CircularProgress","RippleHolder","backgroundRipple","LoadingWrapper","ConsumedIdentityLayout","setSelfIdentity","setGestureDirection","presenceDB","identity","presenceRef","onDisconnect","remove","initPeers","useLayoutEffect","bind","useGesture","onDragEnd","movementX","sign","movement","movementY","abs","undefined","IdentityLayout","rest","attrs","AppContent","MuiAppTheme","createTheme","StyledToastContainer","pauseOnFocusLoss","newestOnTop","closeOnClick","hideProgressBar","rtl","draggable","App","Boolean","hostname","match","reportWebVitals","onPerfEntry","Function","getCLS","getFID","getFCP","getLCP","getTTFB","ReactDOM","render","StrictMode","serviceWorker","ready","registration","unregister","message"],"mappings":"2QAeAA,IAASC,cAVa,CACpBC,OAAQC,0CACRC,WAAYD,qCACZE,YAAaF,yDACbG,UAAWH,qBACXI,cAAeJ,iCACfK,kBAAmBL,eACnBM,MAAON,8CAKMH,I,4BAAAA,IAAf,E,QCjBMU,EAAqB,GAWZC,EATY,WAEzB,IADA,IAAIC,EACKC,EAAI,OAASA,GAAK,OAASA,GAAK,EAAGH,EAASI,KAAKC,OAAOC,cAAcH,IAC/E,IAAII,EAASC,KAAKC,MAAMD,KAAKD,SAAWP,EAASU,QAGjD,OAFAR,EAAcF,EAASO,GACvBP,EAASW,OAAOJ,EAAQ,GACjBL,G,QCGMU,EATE,WACf,IAAMC,EAAcC,QAAaC,OAAOC,UAAUC,WAElD,MAAO,CACLC,QAASL,EAAYK,QAAQC,MAAQ,UACrCC,SAAUP,EAAYO,SAASC,MAAQ,Y,SCP5B,MAA0B,6C,0BCS1BC,EATE,CACfC,WAAY,CACV,CACEC,KAAM,CAAC,gCAAiC,mCAG5CC,qBAAsB,ICNXC,EAAkB,gBAClBC,EAAc,cACdC,EAAS,mBACTC,EAAS,mBACTC,EAAa,YCJbC,EAAuB,qBACvBC,EAAmB,iBACnBC,EAAY,WCFZC,EAAY,WACZC,EAAkB,gBAClBC,EAAoB,kBCDpBC,EAAoB,SCDpBC,EAAgB,YAChBC,EAAwB,oB,OCYxBC,EAAkBC,IAAMC,cAAwC,CAC3EC,QAAS,GACTC,SAAU,GACVC,YAAa,eA0DAC,EAnDU,SAAC,GAAgD,IAA/CC,EAA8C,EAA9CA,SACzB,EAA8BN,IAAMO,SAAiB,IAArD,mBAAOL,EAAP,KAAgBM,EAAhB,KACA,EAAgCR,IAAMO,SAAiB,IAAvD,mBAAOJ,EAAP,KAAiBC,EAAjB,KAoCA,OAlCAK,qBAAU,WACR,IAAIC,EACAC,EACAC,EAA+B,IAAIC,kBAAkBhC,GACzD8B,EAAUC,EAAGE,kBAAkB,IAC/BF,EAAGG,cAAcC,MAAK,SAACC,GAAD,uBAAWL,SAAX,aAAW,EAAIM,oBAAoBD,MAEzD,IAAIE,EAAkBC,eAAeC,QAAQ7B,GAE7CoB,EAAGU,eAAiB,SAACC,GACsC,IAAD,EAAxD,IAAKA,IAAQA,EAAIC,YAAcD,EAAIC,UAAUA,UAK3C,OAJIb,GAASA,EAAQc,QACrBd,EAAU,KACR,QAAF,EAAAC,SAAA,SAAIa,aACJb,EAAK,MAGP,IAAIc,EAAQH,EAAIC,UAAUA,UAAUE,MAAM,KAC1C,GAAiB,SAAbA,EAAM,GAAe,CACvB,GAAIP,EAEF,YADAf,EAAYe,GAGTT,GAAUN,EAAYuB,KAAKD,EAAM,KACtChB,EAAWgB,EAAM,KAGrB7E,EACG+E,OACAC,oBACAb,MAAK,kBAAMR,EAAWsB,kBACtBC,OAAM,kBAAMC,IAAMC,MAAM,2FAC1B,IAGD,cAAClC,EAAgBmC,SAAjB,CACEC,MAAO,CACLjC,UACAC,WACAC,eAJJ,SAOGE,K,6BCrED8B,GAEA,QAFAA,GAGA,SASSC,GANK,CAClBC,GAAG,cAAD,OANE,SAOJC,GAAG,cAAD,OAAgBH,IAClBI,GAAG,cAAD,OAAgBJ,KCwDLK,GA9DYC,IAAOC,IAAV,ksCAOMN,GAAYE,I,oBCP7BK,GAAuBF,IAAOC,IAAV,sNAOX,SAACE,GAAD,OAAWA,EAAMC,MAAMC,QAAQC,QAC1C,SAACH,GAAD,OAAWA,EAAMC,MAAMC,QAAQE,gBAI7BC,GAAeR,IAAOC,IAAV,wFAKZQ,GAAcT,IAAOC,IAAV,sJAOXS,GAAcV,IAAOC,IAAV,gKASXU,GAAgBX,IAAOC,IAAV,8EAKbW,GAAqBZ,YAAOa,KAAPb,CAAH,4DAIlBc,GAAsBd,IAAOC,IAAV,0BAEnBc,GAAqBf,IAAOgB,EAAV,iJAKpB,SAACb,GAAD,OAAWA,EAAMC,MAAMa,UAAUC,S,UCe7BC,GAjESC,cAAW,SAAChB,GAAD,MAAY,CAC7CiB,OAAQ,CACNC,OAAQ,GACR,wBAAyB,CACvBC,IAAK,mBAEP,kCAAmC,CACjCA,IAAK,EACLC,KAAM,EACNC,UAAW,SACXC,MAAO,MACPC,OAAQ,MACR,YAAa,CACXC,YAAa,gBACbC,YAAY,2BAAD,OAA6BzB,EAAM0B,QAAQzB,QAAQC,KAAnD,kBAGf,+BAAgC,CAC9ByB,OAAQ,EACRP,KAAM,EACNQ,aAAc,SACdN,MAAO,MACPC,OAAQ,MACR,YAAa,CACXC,YAAa,gBACbC,YAAY,GAAD,OAAKzB,EAAM0B,QAAQzB,QAAQC,KAA3B,0CAGf,iCAAkC,CAChCkB,KAAM,EACNS,WAAY,SACZN,OAAQ,MACRD,MAAO,MACP,YAAa,CACXE,YAAa,gBACbC,YAAY,eAAD,OAAiBzB,EAAM0B,QAAQzB,QAAQC,KAAvC,8BAGf,gCAAiC,CAC/B4B,MAAO,EACPC,YAAa,SACbR,OAAQ,MACRD,MAAO,MACP,YAAa,CACXE,YAAa,gBACbC,YAAY,uCAAD,OAAyCzB,EAAM0B,QAAQzB,QAAQC,SAIhF8B,MAAO,CACLC,SAAU,WACVC,SAAU,EACVZ,MAAO,MACPC,OAAQ,MACR,YAAa,CACXY,QAAS,KACTC,OAAQ,OACRC,QAAS,QACTf,MAAO,EACPC,OAAQ,EACRe,YAAa,cChBJC,GAlCgC,SAAC,GAAwC,IAAvCC,EAAsC,EAAtCA,UAAWC,EAA2B,EAA3BA,cAAeC,EAAY,EAAZA,OACzE,EAAgCxF,IAAMO,SAAgC,MAAtE,mBAAOkF,EAAP,KAAiBC,EAAjB,KACMC,EAAU9B,KAEhB,OACE,eAAC+B,GAAA,EAAD,CACEC,OAAQN,KAAmBD,EAC3BQ,SAAUP,EACVQ,UAAU,MACVC,UAAWL,EAAQ5B,OACnBkC,UAAW,CACTC,KAAM,CACJC,SAAS,GAEXC,gBAAiB,CACfD,SAAS,EACTE,kBAAmB,gBAErBvB,MAAO,CACLwB,QAASb,IAdf,UAkBE,qBAAKO,UAAWL,EAAQb,MAAOyB,IAAKb,IACpC,cAAC9C,GAAD,UACE,eAACM,GAAD,WACiB,SAAdoC,GAAwB,0BACV,UAAdA,GAAA,wBAA0CE,EAAS,cAAgB,uB,UCnCxEgB,GAAcC,aAAK,UAAW,IAE9BC,GAAqBC,YAAH,gMAGRH,GACIA,GAIAA,IAKdI,GAAqBD,YAAH,yOAGRH,GACEA,GACAA,GAIAA,GACAA,IAKZK,GAAqBnE,YAAOa,KAAPb,CAAH,wRACF,SAACG,GAAD,OAAWA,EAAMC,MAAMa,UAAUmD,QAC5C,SAACjE,GAAD,OAAWA,EAAMC,MAAMa,UAAUV,gBAE1B,SAACJ,GAAD,OAAWA,EAAMC,MAAMa,UAAUX,QAWtC+D,GAAyBrE,YAAOmE,GAAPnE,CAAH,iEACpBgE,IAGFM,GAAwBtE,YAAOmE,GAAPnE,CAAH,mEACnBkE,I,UClDAK,GAJE,SAACvI,EAAcT,GAC9B,OAAOS,EAAKT,OAASA,EAASS,EAAKwI,UAAU,EAAGjJ,GAAU,MAAQS,GCkBrDyI,I,4DAAAA,GAdf,SAAiCC,GAC3BA,EAAenJ,OVHc,EUI/B+D,IAAMC,MAAN,4DVJ+B,IUM/BmF,EAAeC,SAAQ,YAAqB,IAAnBC,EAAkB,EAAlBA,KAAMC,EAAY,EAAZA,OAC7BvF,IAAMC,MAAN,6BACwBgF,GAASK,EAAK5I,KAAM,IAD5C,OAEI6I,EAAOC,MAAK,SAACvF,GAAD,MAA0B,mBAAfA,EAAMwF,QAA6B,gDAAkD,SC8BvGC,GA/BW,SAAC,GAA4D,IAA3DC,EAA0D,EAA1DA,uBAAwBC,EAAkC,EAAlCA,sBAClD,EAAkC5H,IAAMO,SAAoB,MAA5D,mBAAO+E,EAAP,KAAkBuC,EAAlB,KAOA,EAAsCC,aAAY,CAChDC,SXjB+B,EWkB/BC,QAASpI,EACTqI,SAAUN,EACVO,YATkB,kBAAML,EAAa,SAUrCM,YATkB,kBAAMN,EAAa,OAUrCO,eAAgBR,EAChBS,eAAgBlB,KAPXmB,EAAP,EAAOA,aAAcC,EAArB,EAAqBA,cAcrB,OAJAvI,IAAMS,WAAU,WACVkH,GAAwBE,EAAa,QACxC,CAACF,IAEG,CACLW,eACAC,gBACAC,aApBmB,kBAAMX,EAAa,UAqBtCY,aApBmB,kBAAMZ,EAAa,OAqBtCvC,cC/BEoD,GAAUhG,IAAOC,IAAV,qJAMK,SAACE,GAAD,OAAWA,EAAMC,MAAM6F,kBAGnCC,GAAkBlG,IAAOC,IAAV,gGAEV,SAACE,GAAD,OAAWA,EAAMC,MAAMC,QAAQE,gBA6C3B4F,GAjC2B,SAAC,GAAmE,IAAlEC,EAAiE,EAAjEA,aAAcnB,EAAmD,EAAnDA,uBAAwBC,EAA2B,EAA3BA,sBAC1EmB,EAAY/I,IAAMgJ,OAAO,MAE/B,EAA6EtB,GAAkB,CAC7FC,yBACAC,0BAFKU,EAAP,EAAOA,aAAcC,EAArB,EAAqBA,cAAeC,EAApC,EAAoCA,aAAcC,EAAlD,EAAkDA,aAAcnD,EAAhE,EAAgEA,UAOhE,OACE,eAACoD,GAAD,WACE,gDAASJ,KAAT,cACE,eAACtB,GAAD,CACEhB,UAAU,UACVO,IAAKwC,EACLP,aAAcA,EACdC,aAAcA,EACdQ,QAVkB,kBAAQC,SAASC,eAAT,kBAA+DhH,MAAQ,IAWjGiH,QAAQ,YANV,UAQE,+BAAON,EAAaO,QACpB,mCAAOC,GAAE,kBAAwBf,SAEnC,eAACK,GAAD,mBACQE,EAAanK,SADrB,IACgCmK,EAAarK,eAGnC,cAAC,GAAD,CAAuB+G,QAAQ,EAAMF,UAAWA,EAAWC,cAAewD,EAAUQ,c,kBCnDhGX,GAAkBlG,IAAOC,IAAV,gMAGV,SAACE,GAAD,OAAWA,EAAMC,MAAMC,QAAQE,gBAyD3BuG,GA5C2B,SAAC,GAKpC,IAJL7B,EAII,EAJJA,uBACAC,EAGI,EAHJA,sBACA6B,EAEI,EAFJA,WACAC,EACI,EADJA,iBAEMX,EAAY/I,IAAMgJ,OAAO,MAE/B,EAA6EtB,GAAkB,CAC7FC,yBACAC,0BAFKU,EAAP,EAAOA,aAAcC,EAArB,EAAqBA,cAAeC,EAApC,EAAoCA,aAAcC,EAAlD,EAAkDA,aAAcnD,EAAhE,EAAgEA,UAKhEtF,IAAMS,WAAU,WACVsI,EAAUQ,SAASG,EAAiBX,EAAUQ,WACjD,CAACR,EAAWW,IAKf,OACE,qCACE,+CAASpB,KAAT,aACE,eAACvB,GAAD,CACEf,UAAU,UACVO,IAAKwC,EACLd,SAAUN,EACVgC,YAAanB,EACbC,aAAcA,EACdQ,QAZkB,kBACtBC,SAASC,eAAT,oBAAqCM,EAAWH,KAA2BnH,MAAQ,IAY/EiH,QAAQ,YAPV,UASE,mCAAOE,GAAE,oBAAeG,EAAWH,KAAUf,MAC7C,+BAAOkB,EAAWJ,cAGtB,eAAC,GAAD,WACGI,EAAW9K,SADd,IACyB8K,EAAWhL,WAEnC6G,GAAa,cAAC,GAAD,CAAuBE,QAAQ,EAAOF,UAAWA,EAAWC,cAAewD,EAAUQ,cC5DnGb,GAAUhG,IAAOC,IAAV,4FAMPiH,GAAkBlH,IAAOC,IAAV,orBAIC,SAACE,GAAD,OAAWA,EAAMC,MAAMa,UAAUC,SA0BjDiG,GAAenH,IAAOC,IAAV,6DAEP,SAACE,GAAD,OAAWA,EAAMC,MAAMa,UAAUC,SAc7BkG,GAXiB,SAACjH,GAC/B,OACE,eAAC,GAAD,WACE,cAAC+G,GAAD,UACE,0BAAUG,IAAI,MAAM5H,MAAOU,EAAMmH,aAEnC,cAACH,GAAD,oBAAkBhH,EAAMmH,SAAxB,WCrCOC,GAAoBjK,IAAMC,cAA0C,CAC/EiK,kBAAkB,EAClBC,oBAAoB,EACpBC,SAAU,OACVC,iBAAkB,aAClBC,mBAAoB,aACpBC,qBAAsB,eA4BTC,GArBY,SAAC,GAAgD,IAA/ClK,EAA8C,EAA9CA,SAC3B,ECvBgC,WAChC,MAA0CC,oBAAkB,GAA5D,mBAAO2J,EAAP,KAAyBO,EAAzB,KACA,EAA8ClK,oBAAkB,GAAhE,mBAAO4J,EAAP,KAA2BO,EAA3B,KAuBA,OAXAjK,qBAAU,WACR,IAAMkK,EAAgBrM,OAAOsM,aAAavJ,QAAQ3B,GAC5CmL,EAAkBvM,OAAOsM,aAAavJ,QAAQ1B,GAGhDmL,IAAsC,UAApBD,IAAgCA,GAEtDJ,IAHsC,UAAlBE,IAA8BA,IAIlDD,EAAgBI,KACf,IAEI,CACLZ,mBACAC,qBACAE,iBAxBuB,WACvB/L,OAAOsM,aAAaG,QAAQrL,IAAmBwK,GAAkBc,YACjEP,GAAeP,IAuBfI,mBApByB,WACzBhM,OAAOsM,aAAaG,QAAQpL,IAAqBwK,GAAoBa,YACrEN,GAAiBP,KDYkEc,GAA9Ef,EAAP,EAAOA,iBAAkBC,EAAzB,EAAyBA,mBAAoBE,EAA7C,EAA6CA,iBAAkBC,EAA/D,EAA+DA,mBAE/D,EEvByB,WACzB,MAAgC/J,mBAA2B,QAA3D,mBAAO6J,EAAP,KAAiBc,EAAjB,KAiBA,OATAzK,qBAAU,WACR,IAAM0K,EAAe7M,OAAOsM,aAAavJ,QAAQ5B,GAC7C0L,EACFD,EAAYC,GAEZ7M,OAAOsM,aAAaG,QAAQtL,EAAW,UAExC,IAEI,CACL2K,WACAG,qBAjB2B,WAC3B,IAAIa,EAAgC,SAAbhB,EAAsB,QAAU,OACvD9L,OAAOsM,aAAaG,QAAQtL,EAAW2L,GACvCF,EAAYE,KFiB2BC,GAAlCjB,EAAP,EAAOA,SAAUG,EAAjB,EAAiBA,qBAEjB,OACE,cAACN,GAAkB/H,SAAnB,CACEC,MAAO,CACL+H,mBACAC,qBACAC,WACAC,mBACAC,qBACAC,wBAPJ,SAUGjK,KGlBMgL,GAAiD,CAC5DC,QAAQ,EACRC,aAAc,KACdC,aAAc,EACdC,kBAAmB,IASRC,GAAwB,SACnCC,EACAC,GAEA,OAAQA,EAAOjN,MACb,IAAK,QACH,OAAO,eACF0M,IAEP,IAAK,wBACH,OAAO,2BACFM,GADL,IAEEL,QAAQ,EACRC,aAAc,UACdC,aAAcI,EAAOC,QAAQ9B,WAEjC,IAAK,oBACH,OAAO,2BACF4B,GADL,IAEEL,QAAQ,EACRC,aAAc,OACdC,aAAcI,EAAOC,QAAQ9B,WAEjC,IAAK,wBACH,OAAO,2BACF4B,GADL,IAEEF,kBAAkB,GAAD,oBAAME,EAAMF,mBAAZ,CAA+BG,EAAOC,QAAQC,qBAEnE,QACE,OAAOH,IAePI,GAA4C,SAAC,GAS5C,IARLvC,EAQI,EARJA,WACAwC,EAOI,EAPJA,SACAR,EAMI,EANJA,aACAC,EAKI,EALJA,kBACAF,EAII,EAJJA,aACAjG,EAGI,EAHJA,cACA2G,EAEI,EAFJA,qBACA/B,EACI,EADJA,mBAEA,EAAgCnK,IAAMO,SAAgC,MAAtE,mBAAOkF,EAAP,KAAiBC,EAAjB,KACA,EAA0C1F,IAAMO,SAAqC,MAArF,mBAAO4L,EAAP,KAAsBC,EAAtB,KACMzG,EAAU9B,KAEhB7D,IAAMS,WAAU,WACd2L,EAAiBV,KAChB,CAACA,IAEJ1L,IAAMS,WAAU,WACV0J,GAAuC,MAAjBsB,GAAsBQ,MAE/C,CAAC9B,EAAoBsB,IAExB,IAWMY,EAAe,WACnBH,IACAI,KAGIA,EAAc,kBAAML,KAE1B,OACE,eAACrG,GAAA,EAAD,CACEC,OAAQN,EACRO,SAAUP,EACVQ,UAAU,MACVC,UAAWL,EAAQ5B,OACnBkC,UAAW,CACTC,KAAM,CACJC,SAAS,GAEXC,gBAAiB,CACfD,SAAS,EACTE,kBAAmB,gBAErBvB,MAAO,CACLwB,QAASb,IAdf,UAkBE,qBAAKO,UAAWL,EAAQb,MAAOyB,IAAKb,IACpC,cAAC9C,GAAD,UACoB,YAAjB4I,EACC,qCACE,cAACtI,GAAD,UACGiH,EAAqB,sBAAwB,sCAEhD,eAAC/G,GAAD,WACG+I,GACCA,EAAcI,KAAI,SAACjF,EAAM5J,GAAP,OAChB,cAAC8F,GAAD,UACE,eAACC,GAAD,CACEwF,QAAS,kBAjDD,SAAC3B,GAC3BkF,YAAW,kBAAMlO,OAAOmO,IAAIC,gBAAgBpF,EAAKqF,eAAc,GAC/D,IAAIC,EAAgBT,EAAeU,QAAO,SAACC,GAAD,OAAcA,EAASH,cAAgBrF,EAAKqF,eAElFC,EAAc3O,OAAS,EACzBmO,EAAiBQ,GAEjBX,IA0C+Bc,CAAoBzF,IACnC0F,SAAU1F,EAAK2F,SACfC,KAAM5F,EAAKqF,YAHb,sBAKYrF,EAAK2F,aANnB,UAA6BxD,EAAWH,GAAxC,qBAAuD5L,OAUzC,IAAjB+N,GAAsB,cAAC,GAAD,CAAyBzB,SAAUyB,OAE5D,cAACpI,GAAD,UACoB,MAAjBoI,EACC,cAACnI,GAAD,CAAoB8F,QAAQ,WAAWhH,KAAK,QAAQ6G,QAASqD,EAAaa,MAAM,YAAhF,mBAIA,cAAC7J,GAAD,CAAoB8F,QAAQ,WAAWhH,KAAK,QAAQ6G,QAASoD,EAAcc,MAAM,YAAjF,yBAON,qCACE,cAACjK,GAAD,yBACA,eAACE,GAAD,WACE,2EACA,cAAC,GAAD,CAAyB4G,SAAUyB,OAErC,cAACpI,GAAD,UACE,cAACC,GAAD,CAAoB8F,QAAQ,WAAWH,QAASoD,EAAcc,MAAM,YAApE,+BAmBCC,GARgB,SAACvK,GAAD,OAC7B,cAACoH,GAAkBoD,SAAnB,UACG,gBAAElD,EAAF,EAAEA,mBAAF,OACC,cAAC,GAAD,2BAAoBtH,GAApB,IAA2BsH,mBAAoBA,SC9LtCmD,GANO,SAAClL,GAAuC,IAAzBmL,EAAwB,uDAAN,EACrD,GAAa,IAATnL,EAAY,MAAO,MACvB,IAAI1E,EAAIK,KAAKC,MAAMD,KAAKyP,IAAIpL,GAAQrE,KAAKyP,IAAI,OAC7C,OAAQpL,EAAOrE,KAAK0P,IAAI,KAAM/P,IAAI6P,QAAQA,GAAW,IAAM,CAAC,IAAK,MAAO,MAAO,MAAO,OAAO7P,ICgBlFgQ,GAAuD,CAClEnC,QAAQ,EACRoC,UAAW,MAOAC,GAA2B,SACtChC,EACAC,GAEA,OAAQA,EAAOjN,MACb,IAAK,QACH,OAAO,eACF8O,IAEP,IAAK,iBACH,MAAO,CACLnC,QAAQ,EACRoC,UAAW9B,EAAOC,QAAQ6B,WAE9B,QACE,OAAO/B,IA6EEiC,GAjE4B,SAAC,GAOrC,IANL5B,EAMI,EANJA,SACA1G,EAKI,EALJA,cACAoI,EAII,EAJJA,UACAlE,EAGI,EAHJA,WACAyC,EAEI,EAFJA,qBACA4B,EACI,EADJA,qBAEA,EAAgC9N,IAAMO,SAAgC,MAAtE,mBAAOkF,EAAP,KAAiBC,EAAjB,KACMC,EAAU9B,KAYhB,OACE,eAAC+B,GAAA,EAAD,CACEC,OAAQN,EACRO,SAAUP,EACVQ,UAAU,MACVC,UAAWL,EAAQ5B,OACnBkC,UAAW,CACTC,KAAM,CACJC,SAAS,GAEXC,gBAAiB,CACfD,SAAS,EACTE,kBAAmB,gBAErBvB,MAAO,CACLwB,QAASb,IAdf,UAkBE,qBAAKO,UAAWL,EAAQb,MAAOyB,IAAKb,IACpC,eAAC9C,GAAD,WACE,eAACM,GAAD,WACGuG,EAAWJ,MADd,SAC2BI,EAAW9K,SADtC,IACiD8K,EAAWhL,QAD5D,qBAGA,cAAC2E,GAAD,iBACGuK,QADH,IACGA,OADH,EACGA,EAAWpB,KAAI,SAACwB,EAAUrQ,GAAX,OACd,eAACyF,GAAD,WACG4K,EAAUrP,KADb,KACqB4O,GAAcS,EAAU3L,MAD7C,gBAAqBqH,EAAWH,GAAhC,iBAA2C5L,SAK/C,eAAC2F,GAAD,WACE,cAACC,GAAD,CAAoB8F,QAAQ,YAAYhH,KAAK,QAAQ6G,QArCxC,WACnB6E,IACA7B,KAmCkFkB,MAAM,YAAlF,oBAGA,cAAC7J,GAAD,CAAoB8F,QAAQ,WAAWhH,KAAK,QAAQ6G,QA7CtC,WACpBiD,IACAD,KA2CkFkB,MAAM,YAAlF,+BCnGGa,GAAyD,CACpEzC,QAAQ,EACR0C,eAAe,GASJC,GAA4B,SACvCtC,EACAC,GAEA,OAAQA,EAAOjN,MACb,IAAK,QACH,OAAO,eACFoP,IAEP,IAAK,qBACH,MAAO,CACLzC,QAAQ,EACR0C,eAAe,GAGnB,IAAK,wBACH,MAAO,CACL1C,QAAQ,EACR0C,eAAe,GAEnB,IAAK,WACH,OAAO,2BACFrC,GADL,IAEEqC,eAAe,IAEnB,QACE,OAAOrC,IA2DEuC,GAlD6B,SAAC,GAAgD,IAA/C1E,EAA8C,EAA9CA,WAAYwE,EAAkC,EAAlCA,cAAe1I,EAAmB,EAAnBA,cACvE,EAAgCvF,IAAMO,SAAgC,MAAtE,mBAAOkF,EAAP,KAAiBC,EAAjB,KACMC,EAAU9B,KAiBhB,OAfA7D,IAAMS,WAAU,WAEd,IAAI2N,EAOJ,OARAhN,eAAe2J,QAAQxL,EAAkB,KAErC0O,IACFG,EAAgB5B,YAAW,WACzBpL,eAAe2J,QAAQzL,EAAsB,KAC7ChB,OAAO+P,SAASC,WACf,MAEE,WACLC,aAAaH,GACbhN,eAAeoN,WAAWjP,MAE3B,CAAC0O,IAGF,eAACrI,GAAA,EAAD,CACEC,OAAQN,EACRO,SAAUP,EACVQ,UAAU,MACVC,UAAWL,EAAQ5B,OACnBkC,UAAW,CACTC,KAAM,CACJC,SAAS,GAEXC,gBAAiB,CACfD,SAAS,EACTE,kBAAmB,gBAErBvB,MAAO,CACLwB,QAASb,IAdf,UAkBE,qBAAKO,UAAWL,EAAQb,MAAOyB,IAAKb,IACpC,cAAC9C,GAAD,UACE,cAACM,GAAD,UACG+K,EAAa,sCACqBxE,EAAWJ,MADhC,6BAEKI,EAAWJ,MAFhB,0BC4FToF,GA1KgB,SAAC,GAUlB,IATZtO,EASW,EATXA,SACAuO,EAQW,EARXA,eACAC,EAOW,EAPXA,gBACAC,EAMW,EANXA,kBACAC,EAKW,EALXA,sBACAC,EAIW,EAJXA,2BACAC,EAGW,EAHXA,+BACAC,EAEW,EAFXA,mBACAC,EACW,EADXA,mBAEMC,EAAoBlG,iBAA8B,MAElDmG,EAA0BC,uBAAY,WAC1CL,EAA+B,CAACnQ,KAAM,UAClCsQ,EAAkB3F,UACpB2F,EAAkB3F,QAAQ9H,QAC1B4N,QAAQ7B,IAAR,kDAAuD0B,EAAkB3F,QAAQ+F,SAEnFL,MACC,CAACC,EAAmBH,EAAgCE,IAEjDM,EAA2BH,uBAAY,WAC3CR,EAAkBrF,QAASiG,cAW3B,SAAgCC,GAC9BJ,QAAQ7B,IAAI,4BACZ0B,EAAkB3F,QAAUkG,EAAM9O,QAClCuO,EAAkB3F,QAAQmG,WAAa,cACvCR,EAAkB3F,QAAQoG,UAAYC,EACtCV,EAAkB3F,QAAQsG,OAASC,EACnCZ,EAAkB3F,QAAQwG,QAAUD,GAftC,IACME,EADUtB,EAAeuB,WAAWhR,GAAiBiR,IAAI/P,GACjC8P,WAAW/Q,GAAagR,IAAIvB,EAAgBpF,SAEtE4G,EAAe,EACfC,EAAe,EACfC,EAAkB,EAClBC,EAAiB,EACjBC,EAA+B,GAVc,SAqBlCX,EArBkC,gFAqBjD,WAAwCH,GAAxC,8BAAA/L,EAAA,sEACmCsM,EAAcQ,MADjD,WACQC,EADR,QAE0BC,OAF1B,iDAOEH,EAAc5S,KAAK8R,EAAMiB,MACzBN,GAAgBX,EAAMiB,KAAKC,WAC3BL,GAAkBb,EAAMiB,KAAKC,WAEvBhD,EAAY8C,EAAmBC,OAAQ/C,UACvCiD,EAAYjD,EAAUkD,QAAO,SAACC,EAAKxJ,GAAN,OAAewJ,EAAMxJ,EAAKlF,OAAM,GAZrE,EAcqBuL,EAAU0C,GAAxB3R,EAdP,EAcOA,KAAM0D,EAdb,EAcaA,KACP2O,EAAgBhT,KAAKiT,MAAOZ,EAAeQ,EAAa,KAE5D9B,EAA2B,CACzBlQ,KAAM,wBACNkN,QAAS,CAAC9B,SAAU+G,KAIlBT,IAAmBlO,IACf6O,EAAW,IAAIC,KAAKX,GAC1BA,EAAgB,GAChBD,EAAiB,EACjBD,GAAmB,EAEnBrB,EAAmBiC,EAAUvS,IAE3B0R,IAAiBQ,IACnBT,EAAe,EACfhB,KAjCJ,6CArBiD,+BA0DlCW,IA1DkC,6EA0DjD,6BAAApM,EAAA,sDAGMwL,EAAkB3F,UACd4H,EAAajC,EAAkB3F,QAAQ4H,WAC7C9B,QAAQ7B,IAAR,oCAAyC2D,IACtB,SAAfA,GACFpC,EAA+B,CAACnQ,KAAM,UAErB,WAAfuS,IACGhB,GAAcnO,IAAMoP,KAAK,8BAC9BjB,EAAe,EACfjB,EAAkB3F,QAAU,OAZlC,4CA1DiD,yBA0EhD,CACDoF,EACAD,EACAE,EACAM,EACA/O,EACA2O,EACAC,EACAC,EACAG,IA2DF,MAAO,CACLD,oBACAmC,oBA1DuB,yCAAG,WAAOC,GAAP,8BAAA5N,EAAA,6DACpB6N,EAAU7C,EAAeuB,WAAWhR,GAAiBiR,IAAI/P,GACzD6P,EAAgBuB,EAAQtB,WAAW/Q,GAAagR,IAAIoB,GAFhC,SAGOtB,EAAcQ,MAHrB,YAGpBgB,EAHoB,QAKHC,OALG,wBAMxB9C,EAAgBpF,QAAU+H,EAC1B1C,EAAkBrF,QAAU,IAAI1I,kBAAkBhC,GAGlD0Q,IAGMmC,EAA6B1B,EAAcC,WAAW9Q,GAC5DyP,EAAkBrF,QAAQoI,iBAAiB,gBAAgB,SAAClC,GACrDA,EAAMjO,UAKXkQ,EAA2BE,IAAInC,EAAMjO,UAAUqQ,UAJ7CxC,QAAQ7B,IAAI,2BAQVvM,EAAQuQ,EAAoBd,OAAQzP,MAC1CoO,QAAQ7B,IAAI,aAAcvM,GAzBF,UA0BlB2N,EAAkBrF,QAAQuI,qBAAqB,IAAIC,sBAAsB9Q,IA1BvD,yBA4BH2N,EAAkBrF,QAAQyI,eA5BvB,eA4BlBC,EA5BkB,OA6BxB5C,QAAQ7B,IAAI,kBAAmByE,GA7BP,UA8BlBrD,EAAkBrF,QAAQrI,oBAAoB+Q,GA9B5B,eAgClBC,EAAiB,CACrBD,OAAQ,CACNrT,KAAMqT,EAAOrT,KACbuT,IAAKF,EAAOE,KAEdC,aAAa,GArCS,UAuClBpC,EAAcqC,OAAOH,GAvCH,QA0ClBI,EAAsBtC,EAAcC,WAAW7Q,GAAQmT,YAAW,SAACC,GACvEA,EAASC,aAAapL,QAAtB,yCAA8B,WAAOqL,GAAP,gBAAAhP,EAAA,yDACR,UAAhBgP,EAAO9T,KADiB,uBAEtB8R,EAAOgC,EAAOxC,IAAIQ,OACtBrB,QAAQ7B,IAAR,wCAA6CmF,KAAKC,UAAUlC,KAC5DrB,QAAQ7B,IAAIoB,EAAkBrF,SAJJ,SAKpBqF,EAAkBrF,QAASsJ,gBAAgB,IAAIC,gBAAgBpC,IAL3C,2CAA9B,0DASF7B,EAAsBtF,QAAU+I,EApDR,4CAAH,wDCiIZS,GA1OkB,SAAC,GAapB,IAZZ7S,EAYW,EAZXA,QACAC,EAWW,EAXXA,SACAuO,EAUW,EAVXA,eACAC,EASW,EATXA,gBACAC,EAQW,EARXA,kBACAoE,EAOW,EAPXA,sBACAC,EAMW,EANXA,2BACAC,EAKW,EALXA,iBACAC,EAIW,EAJXA,kBACAC,EAGW,EAHXA,oBACArE,EAEW,EAFXA,+BACAD,EACW,EADXA,2BAEMuE,EAAiBrK,iBAA8B,MAE/CsK,EAAelE,sBAAW,wBAAC,iCActBmE,EAdsB,YAAA7P,EAAA,yDActB6P,EAdsB,WAe7BvR,IAAMwR,QAAQ,6BACdC,EAAiB,EACjBpD,EAAkB,EAClBqD,EAAc,EACd5E,EAA2B,CAAClQ,KAAM,UAClCwU,EAAoB7J,QAAU,IAnB3B6J,EAAoB7J,SAAkD,IAAvC6J,EAAoB7J,QAAQtL,OADjC,iDAE/BoR,QAAQ7B,IAAR,iBAA8B4F,EAAoB7J,SAE5CoK,EAJyB,aAIbP,EAAoB7J,SAEhCqK,EANyB,UAMRhF,EAAkBrF,eANV,iBAMR,EAA2BsK,YANnB,aAMR,EAAiCD,eACxDvE,QAAQ7B,IAAI,4BAA6BoG,GAEnCE,EAAYF,GvBjDQ,MuBkDtBH,EAAiB,EACjBpD,EAAkB,EAClBqD,EAAc,EAWlBP,EAAkB5J,QAAU,IAAIwK,WAChCZ,EAAkB5J,QAAQoI,iBAAiB,SAAS,SAAC1P,GACnDoN,QAAQpN,MAAM,sBAAuBA,GACrCD,IAAMC,MAAN,+BAAoC0R,EAAMtD,GAAiB3R,UAE7DyU,EAAkB5J,QAAQoI,iBAAiB,SAAS,SAAClC,GACnDJ,QAAQ7B,IAAI,wBAAyBiC,GACrCzN,IAAMoP,KAAN,2BAA+BuC,EAAMtD,GAAiB3R,UAExDyU,EAAkB5J,QAAQoI,iBAAiB,QAAQ,SAAClC,GAClD,IAAIuE,EAASvE,EAAOrE,OAAQ4I,OAE3BX,EAAe9J,QAA2B0K,KAAKD,GAEhDN,GAAeM,EAAOrD,WACtB8C,GAAkBO,EAAOrD,WAEzB,IAAIuD,EAAenW,KAAKiT,MAAO0C,EAAcR,EAAiB3J,QAAW,KAEzEuF,EAA2B,CACzBlQ,KAAM,oBACNkN,QAAS,CAAC9B,SAAUkK,KAGlBR,EAAcR,EAAiB3J,QACjC,SAAU4K,IAEHd,EAAe9J,QAA2B6K,eAAiBJ,EAAOrD,WvBxF9C,SuByFvB0D,EAAUZ,GAGVjH,WAAW2H,EAAmB,KANlC,IAUA9E,QAAQ7B,IAAI,iBACZ+F,SAIEc,EAAY,SAACC,GAIjB,IAAIC,EAGJ,GAAID,EAAIX,EAAMtD,GAAiBjO,KAAM,CACnC,IAAIoS,EAAoBF,EAAIR,EAExBU,EAAYb,EAAMtD,GAAiBjO,OAAMoS,EAAYb,EAAMtD,GAAiBjO,MAEhFmS,EAAQZ,EAAMtD,GAAiBkE,MAAMd,EAAgBe,OAChD,CAIL,GADAf,EAAiB,GACZE,EAFLtD,GAAmB,GAKjB,YADAkD,IAIFgB,EAAQZ,EAAMtD,GAAiBkE,MAAMd,EAAgBK,GAGvDX,EAAkB5J,QAASkL,kBAAkBF,KAIrC,GA7FqB,4CA8F9B,CACDlB,EACAH,EACAC,EACAC,EACAxE,EACAE,IAGI4F,EAAwBtF,uBAAY,WASxC,SAASuF,IAEP,GAAItB,EAAe9J,QAAS,CAC1B,IAAO4H,EAAckC,EAAe9J,QAA7B4H,WACP9B,QAAQ7B,IAAR,iCAAsC2D,IACnB,SAAfA,IACFmC,IACAvE,EAA+B,CAACnQ,KAAM,WAErB,WAAfuS,IACFkC,EAAe9J,QAAU,OAlB/B8J,EAAe9J,QAAUqF,EAAkBrF,QAASzI,kBAAkB,mBACtEuO,QAAQ7B,IAAI,8BAA+B6F,EAAe9J,SAE1D8J,EAAe9J,QAAQmG,WAAa,cACpC2D,EAAe9J,QAAQsG,OAAS8E,EAChCtB,EAAe9J,QAAQwG,QAAU4E,EACjCtB,EAAe9J,QAAQqL,QAgBvB,SAAiBC,GACf,GAAIxB,EAAe9J,QAEjB,YADA8F,QAAQpN,MAAM,wBAAyB4S,GAGzCxF,QAAQ7B,IAAI,gDAAiDqH,MAE9D,CAACjG,EAAmByE,EAAgBC,EAAcvE,IA+ErD,MAAO,CACLsE,iBACAyB,wBA/E2B,yCAAG,WAAOC,GAAP,gCAAArR,EAAA,6DACxB6N,EAAU7C,EAAeuB,WAAWhR,GAAiBiR,IAAI/P,GACzD6U,EAAiBzD,EAAQtB,WAAW/Q,GACpC+V,EAAsBD,EAAe9E,MAErCgF,EAAU,CACdC,IAAK,CACHlU,MAAOf,EACP+R,OAAQ8C,EAAKzL,KAIX8L,EAA6BH,EAAoBhF,WAAW7Q,GAElEwP,EAAkBrF,QAAU,IAAI1I,kBAAkBhC,GAElD8P,EAAgBpF,QAAU0L,EAAoB3L,GAG9CoL,IAEA9F,EAAkBrF,QAAQoI,iBAAiB,gBAAgB,SAAClC,GACrDA,EAAMjO,UAKX4T,EAA2BxD,IAAInC,EAAMjO,UAAUqQ,UAJ7CxC,QAAQ7B,IAAI,2BAvBc,UA+BVoB,EAAkBrF,QAAQxI,cA/BhB,eA+BxBE,EA/BwB,iBAgCxB2N,EAAkBrF,QAAQrI,oBAAoBD,GAhCtB,eAiC9BoO,QAAQ7B,IAAI,iBAAkBvM,GAExBoU,EAAgB,CACpBpU,MAAO,CACLrC,KAAMqC,EAAMrC,KACZuT,IAAKlR,EAAMkR,KAEbC,aAAa,GAxCe,UA2CxB6C,EAAoBK,IAApB,2BACDD,GACAH,IA7CyB,QAiDxBK,EAA0BN,EAAoB1C,WAApB,yCAA+B,WAAOC,GAAP,kBAAA9O,EAAA,0DACvDgN,EAAO8B,EAAS9B,SACRA,EAAKuB,OAF0C,qDAGzDrD,EAAkBrF,SAAYqF,EAAkBrF,QAASiM,yBAHA,uBAKrDC,EAAwB,IAAI1D,sBAAsBrB,EAAKuB,QALF,SAMrDrD,EAAkBrF,QAASuI,qBAAqB2D,GANK,OAQ3D1G,EAA+B,CAACnQ,KAAM,aARqB,2CAA/B,uDAWhCqU,EAA2B1J,QAAUgM,EAG/BG,EAAqBT,EAAoBhF,WAAW9Q,GAAQoT,YAAW,SAACC,GAC5EA,EAASC,aAAapL,QAAtB,yCAA8B,WAAOqL,GAAP,gBAAAhP,EAAA,yDACR,UAAhBgP,EAAO9T,KADiB,uBAEtB8R,EAAOgC,EAAOxC,IAAIQ,OAFI,SAIpB9B,EAAkBrF,QAASsJ,gBAAgB,IAAIC,gBAAgBpC,IAJ3C,2CAA9B,0DAQFsC,EAAsBzJ,QAAUmM,EAEhC3G,EAA+B,CAACnQ,KAAM,0BA1ER,4CAAH,wDCqKhB+W,GAhT+B,SAAC,GAOxC,IANLlM,EAMI,EANJA,WACAvJ,EAKI,EALJA,QACAC,EAII,EAJJA,SACAuO,EAGI,EAHJA,eACAkH,EAEI,EAFJA,aACAC,EACI,EADJA,kBAEMC,EAAS9M,kBAAO,GAChB4F,EAAoB5F,iBAAiC,MACrD2F,EAAkB3F,iBAAsB,MACxCmK,EAAoBnK,iBAA0B,MAC9CkK,EAAmBlK,iBAAe,GAClCoK,EAAsBpK,iBAAe,IACrC6F,EAAwB7F,mBACxBgK,EAAwBhK,mBACxBiK,EAA6BjK,mBAEnC,EAA0CzI,mBAAS,MAAnD,mBAAOgF,EAAP,KAAsBmE,EAAtB,KAEA,EAAiEqM,qBAC/D7H,GACAF,IAFF,mBAAOgI,EAAP,KAA+BjH,EAA/B,KAIA,EAA+DgH,qBAC7DnI,GACAF,IAFF,mBAAOuI,EAAP,KAA8BC,EAA9B,KAIA,EAAyDH,qBAAWpK,GAAuBL,IAA3F,mBAAO6K,EAAP,KAA2BrH,EAA3B,KAEMnH,EAAyByO,mBAC7B,kBAAMJ,EAAuBzK,QAAU0K,EAAsB1K,QAAU4K,EAAmB5K,SAC1F,CAACyK,EAAuBzK,OAAQ0K,EAAsB1K,OAAQ4K,EAAmB5K,SAGnF9K,qBAAU,WACR,IAGM4V,EAHU3H,EAAeuB,WAAWhR,GAAiBiR,IAAI/P,GACjC8P,WAAW/Q,GAEPqT,WAAd,yCAAyB,WAAOC,GAAP,UAAA9O,EAAA,sDAC3C8O,EAASC,aAAapL,QAAtB,yCAA8B,WAAOqL,GAAP,oBAAAhP,EAAA,sDACxBgN,EAAOgC,EAAOxC,IAAIQ,OACF,aAAhBgC,EAAO9T,OACFwT,EAAe1B,EAAf0B,YAEL1B,EAAKyE,KACLzE,EAAK/C,YACJ+C,EAAKuB,QACNvB,EAAKyE,IAAIlD,SAAW/R,GACpBwQ,EAAKyE,IAAIlU,QAAUwI,EAAWH,KAEzB8I,GACHkE,GAAkC5F,EAAK/C,UAAW+E,EAAOxC,IAAI5G,MAI/C,YAAhBoJ,EAAO9T,OACL2X,EAAe7D,EAAOxC,IAAI5G,GAC9B+F,QAAQ7B,IAAI,uBACZ6B,QAAQ7B,IAAI+I,EAAc5H,EAAgBpF,SAExCgN,IAAiB5H,EAAgBpF,UACjCmH,EAAKyE,KACJzE,EAAKyE,IAAIlD,SAAW/R,GAAWwQ,EAAKyE,IAAIlU,QAAUf,GAEnDsW,GAAkB,IAzBM,2CAA9B,uDAD2C,2CAAzB,uDAgCpB,OAAO,WAELH,IACAG,GAAkB,GAClBC,KACIrV,eAAeC,QAAQ9B,KACzByC,IAAMoP,KAAK,2BACXhQ,eAAeoN,WAAWjP,OAI7B,IAEHkB,qBAAU,WACJqV,EAAOvM,QACTuM,EAAOvM,SAAU,GAEjB3B,GAAsB,aAAIgO,IAC1BC,OAGD,CAACC,EAAQF,IAEZ,IAAMc,EAA0BtH,sBAAW,wBAAC,iCAAA1L,EAAA,yDACtCmL,EAAsBtF,SAASsF,EAAsBtF,UACrDyJ,EAAsBzJ,SAASyJ,EAAsBzJ,UACrD0J,EAA2B1J,SAAS0J,EAA2B1J,YAE7DgN,EAAe5H,EAAgBpF,SALK,wBAOlCgI,EAAU7C,EAAeuB,WAAWhR,GAAiBiR,IAAI/P,GACzD6P,EAAgBuB,EAAQtB,WAAW/Q,GAAagR,IAAIqG,GARlB,SASTvG,EAAcC,WAAW9Q,GAAQqR,MATxB,qBAUvBnJ,QAAjB,yCAAyB,WAAO7F,GAAP,UAAAkC,EAAA,sEACjBlC,EAAU+E,IAAIoQ,SADG,2CAAzB,uDAVwC,UAaT3G,EAAcC,WAAW7Q,GAAQoR,MAbxB,sBAcvBnJ,QAAjB,yCAAyB,WAAO7F,GAAP,UAAAkC,EAAA,sEACjBlC,EAAU+E,IAAIoQ,SADG,2CAAzB,uDAdwC,UAiBlC3G,EAAc2G,SAjBoB,QAkBxChI,EAAgBpF,QAAU,KAlBc,4CAoBzC,CACDmF,EACAC,EACAE,EACAmE,EACAC,EACA9S,IA4BF,EAAiDsO,GAAuB,CACtEtO,WACAuO,iBACAC,kBACAC,oBACAC,wBACAC,6BACAC,iCACAC,mBAjCyB,SAAC4H,EAAoBlY,GAI9C,GAF+C,SADvBJ,OAAOsM,aAAavJ,QAAQ1B,GAG5B,CACtB,IAAIkX,EAAiB3N,SAAS4N,cAAc,KAC5CD,EAAe3J,KAAOT,IAAIsK,gBAAgBH,GAC1CC,EAAe7J,SAAWtO,EAC1BwK,SAAS8N,KAAKC,YAAYJ,GAC1BA,EAAeK,QACf5Y,OAAOmO,IAAIC,gBAAgBmK,EAAe3J,MAC1ChE,SAAS8N,KAAKG,YAAYN,QAE1B/H,EAA2B,CACzBlQ,KAAM,wBACNkN,QAAS,CACPC,iBAAkB,CAChBkB,SAAUvO,EACViO,YAAaF,IAAIsK,gBAAgBH,QAgBzC3H,mBAAoByH,IATfxH,EAAP,EAAOA,kBAAmBmC,EAA1B,EAA0BA,oBAY1B,EAAkD0B,GAAyB,CACzE7S,UACAC,WACAuO,iBACAC,kBACAC,oBACAoE,wBACAC,6BACAC,mBACAC,oBACAC,sBACAtE,6BACAC,mCAZKsE,EAAP,EAAOA,eAAgByB,EAAvB,EAAuBA,wBAejB0B,EAAoBpH,uBACxB,SAACgI,GAECrI,EAA+B,CAACnQ,KAAM,UAElCyU,EAAe9J,UACjB8J,EAAe9J,QAAQ9H,QACnB2V,GAAYpV,IAAMoP,KAAK,2BAC3B/B,QAAQ7B,IAAR,+CAAoD6F,EAAe9J,QAAQ+F,SAEzEJ,EAAkB3F,UACpB2F,EAAkB3F,QAAQ9H,QAC1B4N,QAAQ7B,IAAR,kDAAuD0B,EAAkB3F,QAAQ+F,SAEnFoH,MAEF,CAACrD,EAAgBnE,EAAmBwH,IAGhCD,GAAoBrH,uBAAY,WAChCR,EAAkBrF,UACpB8F,QAAQ7B,IAAI,4BACZoB,EAAkBrF,QAAQ9H,QAC1BmN,EAAkBrF,QAAU,QAG7B,CAACqF,IAlMA,SAoMWhH,GApMX,mFAoMJ,WAAqC+L,GAArC,0BAAAjQ,EAAA,2DACMiQ,EAAM1V,OAAS,GADrB,wBAEImV,EAAoB7J,QAAUoK,EAFlC,SAIUmB,EAAwBrL,GAJlC,cAKU8M,EAAe5H,EAAgBpF,QAE/BgI,EAAU7C,EAAeuB,WAAWhR,GAAiBiR,IAAI/P,GACzD6U,EAAiBzD,EAAQtB,WAAW/Q,GACpC+V,EAAsBD,EAAe9E,IAAIqG,GAE3Cc,EAAqB,GAEzB1D,EAAMtM,SAAQ,SAACC,GACb+P,EAAM1Z,KAAK,CACTe,KAAM4I,EAAK5I,KACX0D,KAAMkF,EAAKlF,KACXxD,KAAM0I,EAAK1I,OAEbsU,EAAiB3J,SAAWjC,EAAKlF,QAG/BuL,EAtBR,gBAuBOtO,EAAagY,GAvBpB,UA0BUpC,EAAoB5C,OAAO1E,GA1BrC,6CApMI,sBAkOJ,IAAMG,GAAuB,WAC3BuD,EAAoB1C,EAAgBpF,SAC/ByM,EAAuBzK,QAC1BwD,EAA+B,CAACnQ,KAAM,wBAIpCsN,GAAuB,WACvBiH,EAAkB5J,SAAoD,IAAzC4J,EAAkB5J,QAAQ4H,aACzD9B,QAAQ7B,IAAI,sBACZ2F,EAAkB5J,QAAQ+N,SAExBrB,EAAsB1K,QACxB2K,EAA8B,CAACtX,KAAM,UAEvC4X,GAAkB,IAGdF,GAAiC,yCAAG,WAAO3I,EAAwB4I,GAA/B,gBAAA7S,EAAA,sDACxC2L,QAAQ7B,IAAI,uBAAwBG,GACpC0B,QAAQ7B,IAAI,YAAa/D,GAEzBkF,EAAgBpF,QAAUgN,EAEpB5L,EAAgBrM,OAAOsM,aAAavJ,QAAQ3B,GACP,SAAlBiL,EAGvBmD,KAEAoI,EAA8B,CAACtX,KAAM,iBAAkBkN,QAAS,CAAC6B,eAZ3B,2CAAH,wDAgBvC,OACE,sBAAK3H,UAAU,aAAf,UACE,cAAC,GAAD,CACE2B,uBAAwBA,EACxBC,sBAAuBA,GACvB6B,WAAYA,EACZC,iBAAkBA,IAGnBsM,EAAuBzK,QACtB,cAAC,GAAD,2BAAwByK,GAAxB,IAAgDvM,WAAYA,EAAYlE,cAAeA,KAGxF4Q,EAAmB5K,QAClB,cAAC,GAAD,2BACM4K,GADN,IAEEjK,qBAAsBA,GACtBzC,WAAYA,EACZwC,SAAU,kBAAM6C,EAA2B,CAAClQ,KAAM,WAClD2G,cAAeA,KAIlB0Q,EAAsB1K,QACrB,cAAC,GAAD,2BACM0K,GADN,IAEEnI,qBAAsBA,GACtB5B,qBAAsBA,GACtBzC,WAAYA,EACZwC,SAAU,kBAAMiK,EAA8B,CAACtX,KAAM,WACrD2G,cAAeA,S,UCjUnBgS,GAAU7U,IAAO8U,EAAV,6LACF,SAAC3U,GAAD,OAAWA,EAAMC,MAAMC,QAAQE,gBAC1B,SAACJ,GAAD,OAAYA,EAAM4U,YAAc,MAAQ,SAC5C,SAAC5U,GAAD,OAAYA,EAAM4U,YAAc,MAAQ,UAS9CC,GAAchV,YAAOD,GAAPC,CAAH,uVAQWL,GAAYE,IAelCoV,GAAiC,SAAC,GAAuC,IAAtC7O,EAAqC,EAArCA,aAAc3I,EAAuB,EAAvBA,SAAUD,EAAa,EAAbA,QAC/D,EAAoCK,mBAAuB,IAA3D,mBAAOqX,EAAP,KAAmBC,EAAnB,KACA,EAAwCtX,mBAAiB,IAAzD,mBAAOqV,EAAP,KAAqBkC,EAArB,KAEMC,EAAQ/X,IAAMgJ,OAAOnM,EAASmb,aAkCpC,SAASnC,IACHD,EAAa3X,OAAS,GAAG6Z,EAAgB,IAjC/CrX,qBAAU,WACR,IACMwX,EADKpb,EAASqb,WACA3R,IAAH,UAAUpG,IAe3B,OAdA8X,EAASE,GAAG,QAAZ,yCAAqB,WAAO3F,GAAP,oBAAA9O,EAAA,sDAGnB,IAAS4F,KAFH8O,EAAyB5F,EAAS6F,MACpCC,EAA2B,GAChBF,EACT9O,IAAOpJ,GAASoY,EAAW3a,KAAKya,EAAS9O,IAE3CgP,EAAWra,OzB1Dc,IyB2D3B+D,IAAMuW,UACNvW,IAAMoP,KAAN,iDzB5D2B,MyB8D3ByG,EAAcS,GAVG,2CAArB,uDAcO,WACLL,EAASO,SAGV,CAACrY,IAeJ,IAAIsY,EAA+B,IAAtBb,EAAW3Z,OAExB,OACE,qCACE,cAACya,GAAA,EAAD,CAAMC,GAAIF,EAAV,SACE,eAAClB,GAAD,CAASE,aAAcgB,EAAvB,uDAEE,uBACA,wGAGJ,cAACC,GAAA,EAAD,CAAMC,IAAKF,EAAX,SACE,cAACf,GAAD,UACGE,EAAWrL,KAAI,SAACwI,GAAD,OACd,cAAC,GAAD,CACEc,kBAAmBA,EACnBD,aAAcA,EACdlH,eAAgBqJ,EAAMxO,QAEtBE,WAAYsL,EACZ5U,SAAUA,EACVD,QAASA,GAHJ6U,EAAKzL,WAQjBR,GACC,cAAC,GAAD,CACEnB,uBAAwBiO,EAAa3X,OAAS,EAC9C2J,sBA1CR,SAA+B+L,GACH,IAAtBiE,EAAW3Z,QACb+D,IAAMoP,KAAK,wCACXyE,KAEAiC,EAAgBnE,IAsCZxT,SAAUA,EACVD,QAASA,EACT4I,aAAcA,QAOT8P,kBAAKjB,I,oGChIPkB,GAAkB,CAC7BjV,MAAO,CACLb,QAAS,CACP+D,KAAM,UACNlD,MAAO,UACPZ,KAAM,UACNC,aAAc,WAEhBU,UAAW,CACTmD,KAAM,UACN9D,KAAM,UACNY,MAAO,UACPX,aAAc,SAGlBD,KAAM,CACJD,QAAS,CACP+D,KAAM,UACNlD,MAAO,UACPZ,KAAM,UACNC,aAAc,QAEhBU,UAAW,CACTmD,KAAM,UACN9D,KAAM,UACNY,MAAO,UACPX,aAAc,UAULH,GALJ,aACT6F,eAAgB,QACbkQ,GAAgB7V,MCQN8V,GAtCShV,cAAW,SAAChB,GAAD,OACjCiW,aAAa,CACXC,KAAM,CACJ7T,QAAS,QAEX8T,OAAQ,CACNC,WAAY,EACZC,WAAY,UAEdC,WAAY,CACVhV,MAAO,IACPiV,WAAYvW,EAAMwW,YAAYC,OAAO,QAAS,CAC5CC,OAAQ1W,EAAMwW,YAAYE,OAAOC,MACjCC,SAAU5W,EAAMwW,YAAYI,SAASC,kBAGzCC,YAAa,CACXxV,MAAOgG,GAASzB,eAChB0Q,WAAYvW,EAAMwW,YAAYC,OAAO,QAAS,CAC5CC,OAAQ1W,EAAMwW,YAAYE,OAAOC,MACjCC,SAAU5W,EAAMwW,YAAYI,SAASG,gBAEvCC,SAAU,UAEZC,UAAW,CACT/U,SAAU,GACVD,SAAU,WACVb,KAAM,IAER8V,SAAU,CACR7U,QAAS,OACT8U,WAAY,SACZ5V,OAAQ,GACR6V,eAAgB,iB,8QCThBC,GAAqBzX,YAAO0X,KAAP1X,CAAH,gFAEb,SAACG,GAAD,OAAWA,EAAMC,MAAMC,QAAQE,gBAGpCoX,GAAiB3X,YAAO4X,KAAP5X,CAAH,uZASJ,SAACG,GAAD,OAAYA,EAAM0X,QAAU,UAAY,YAU3C,SAAC1X,GAAD,OAAWA,EAAMC,MAAMC,QAAQE,gBAItCuX,GAAa9X,YAAO+X,KAAP/X,CAAH,8DAcVgY,GAAgD,SAAC,GAWhD,IAVLva,EAUI,EAVJA,SACAiZ,EASI,EATJA,WACAlP,EAQI,EARJA,iBACAC,EAOI,EAPJA,mBACAC,EAMI,EANJA,SACAC,EAKI,EALJA,iBACAC,EAII,EAJJA,mBACAC,EAGI,EAHJA,qBACAoQ,EAEI,EAFJA,wBACAC,EACI,EADJA,qBAEMC,EAAkB,yCAAG,WAAOC,GAAP,UAAApX,EAAA,6DACzBoX,EAAEC,kBADuB,kBAGjBxc,UAAUyc,UAAUC,UAAU9a,GAHb,OAIvB6B,IAAMuW,UACNvW,IAAMkZ,KAAK,iBAAkB,CAC3BC,UAAW,MANU,gDAStBjS,SAASC,eAAetJ,GAAoCub,SATtC,yDAAH,sDAexB,OACE,qCACE,eAACX,GAAA,EAAD,WACE,cAACY,GAAA,EAAD,CAASC,MAAO,cAAevV,UAAU,QAAzC,SACE,eAACuU,GAAA,EAAD,CAAUiB,QAAM,EAACtS,QAASoB,EAA1B,UACE,cAAC8P,GAAD,UAAqBjQ,EAAmB,cAAC,KAAD,IAAe,cAAC,KAAD,MACvD,cAACsR,GAAA,EAAD,CAAczY,QAAS,wBACvB,cAAC0Y,GAAA,EAAD,CAAQC,QAASxR,EAAkByR,WAAY,CAAC,aAAc,6BAIlE,cAACN,GAAA,EAAD,CAASC,MAAO,gBAAiBvV,UAAU,QAA3C,SACE,eAACuU,GAAA,EAAD,CAAUiB,QAAM,EAACtS,QAASqB,EAA1B,UACE,cAAC6P,GAAD,UAAqBhQ,EAAqB,cAAC,KAAD,IAAgB,cAAC,KAAD,MAC1D,cAACqR,GAAA,EAAD,CAAczY,QAAS,uBACvB,cAAC0Y,GAAA,EAAD,CAAQC,QAASvR,EAAoBwR,WAAY,CAAC,aAAc,gCAKtE,cAACC,GAAA,EAAD,IAEA,eAACnB,GAAA,EAAD,WACE,cAACY,GAAA,EAAD,CAASC,MAAM,mBAAmBvV,UAAU,QAA5C,SACE,eAACuU,GAAA,EAAD,CAAUiB,QAAM,EAACtS,QAASsB,EAA1B,UACE,cAAC4P,GAAD,UACgB,UAAb/P,EAAuB,cAAC,KAAD,IAA0B,cAAC,KAAD,MAEpD,cAACoR,GAAA,EAAD,CAAczY,QAAS,4BAG3B,cAACsY,GAAA,EAAD,CAASC,MAAM,oBAAoBvV,UAAU,QAA7C,SACE,eAACuU,GAAA,EAAD,CAAUiB,QAAM,EAACtS,QAAS0R,EAA1B,UACE,cAACR,GAAD,UACE,cAAC,KAAD,MAEF,cAACqB,GAAA,EAAD,CAAczY,QAAS,wBAK7B,cAAC6Y,GAAA,EAAD,IAEA,cAACnB,GAAA,EAAD,UACE,eAACJ,GAAD,CAAgBkB,QAAM,EAACjS,GAAIxJ,EAAuBya,QAASnB,EAAYnQ,QAAS,SAAC6R,GAAD,OAAOD,EAAmBC,IAA1G,UACE,gCACE,4CACA,uBACA,cAACe,GAAA,EAAD,CAAWvS,GAAIzJ,EAAesC,MAAOhC,EAAUwb,WAAY,CAAC,aAAc,cAE5E,cAACxB,GAAD,UACE,cAAC,KAAD,WAKN,eAACK,GAAD,WACE,cAACa,GAAA,EAAD,CAASC,MAAM,QAAQvV,UAAU,QAAjC,SACE,eAACuU,GAAA,EAAD,CAAUiB,QAAM,EAACtS,QAAS2R,EAA1B,UACE,cAACT,GAAD,UACE,cAAC,KAAD,MAEF,cAACqB,GAAA,EAAD,CAAczY,QAAS,eAG3B,cAACsY,GAAA,EAAD,CAASC,MAAM,cAAcvV,UAAU,QAAvC,SACE,eAACuU,GAAA,EAAD,CAAUiB,QAAM,EAACtS,QApEI,kBAAM3K,OAAOuH,KAAK,4CAoEvC,UACE,cAACsU,GAAD,UACE,cAAC,KAAD,MAEF,cAACqB,GAAA,EAAD,CAAczY,QAAS,uBAcpB+Y,GANkB,SAACjZ,GAAD,OAC/B,cAAC9C,EAAgBsN,SAAjB,UACG,gBAAElN,EAAF,EAAEA,SAAF,OAA0C,cAAC,GAAD,aAAkBA,SAAUA,GAAc0C,Q,4DCnKnFkZ,GAAsBrZ,YAAOsZ,KAAPtZ,CAAH,+DASnBuZ,GAAmB,IAAIC,OAAO,qBA+CrBC,GA7CwB,SAAC,GAAyB,IAAxBtW,EAAuB,EAAvBA,KAAMyG,EAAiB,EAAjBA,YAC7C,EAA0BtM,IAAMO,SAAS,IAAzC,mBAAO6b,EAAP,KAAcC,EAAd,KAgBA,OACE,eAACC,GAAA,EAAD,CAAQzW,KAAMA,EAAM0W,QAASjQ,EAA7B,UACE,cAACkQ,GAAA,EAAD,kCACA,eAACC,GAAA,EAAD,WACE,cAACC,GAAA,EAAD,qEACA,cAACC,GAAA,EAAD,CACEC,SAXa,SAACnN,GACpB,IAAIoN,EAAcpN,EAAMrE,OAAOjJ,OAC3B8Z,GAAiBa,KAAKD,IAAgC,KAAhBA,IAAoBR,EAASQ,IAUjE1a,MAAOia,EACPW,WAAS,EACT5P,MAAM,YACNjI,OAAO,QACPoK,MAAM,UACN1Q,KAAK,OACLoe,WAAS,OAGb,eAACjB,GAAD,WACE,cAACxY,GAAA,EAAD,CAAQ0F,QAASqD,EAAaa,MAAM,YAApC,oBAGA,cAAC5J,GAAA,EAAD,CAAQ0F,QAlCQ,YACfmT,EAAMa,QAAUb,EAAMne,OAAS,GAAKme,EAAMne,OAAS,GACtD+D,IAAMC,MAAM,2BAGdb,eAAe2J,QAAQvL,EAAW4c,GAClC9d,OAAO+P,SAASC,WA4BoBnB,MAAM,YAAtC,4B,UCnDF+P,GAAcxa,IAAOC,IAAV,6HAyDFwa,GAxCqB,SAAC,GAAyB,IAAxBtX,EAAuB,EAAvBA,KAAMyG,EAAiB,EAAjBA,YAC1C,OACE,cAACgQ,GAAA,EAAD,CAAQzW,KAAMA,EAAM0W,QAASjQ,EAA7B,SACE,eAACmQ,GAAA,EAAD,WACE,cAACS,GAAD,oBACA,eAACR,GAAA,EAAD,4BACgB,4CADhB,kDACuF,IACrF,cAACU,GAAA,EAAD,CAAMlQ,KAAK,2BAA2BmQ,IAAI,aAAajS,OAAO,SAA9D,uBAFF,sLAOE,+BACE,kFACA,8GACA,uIAVJ,uGAeA,cAAC8R,GAAD,0BACA,cAACR,GAAA,EAAD,8MAKA,cAACA,GAAA,EAAD,kHAIA,eAACA,GAAA,EAAD,0CAC8B,iCAASpP,GAAc1N,EAAmB,KADxE,eACiG,IAC/F,iC9BxDyB,I8BsD3B,iCAEsE,iC9BvD3C,K8BuDkF,IAF7G,4BCxCF0d,GAAmB5a,YAAO6a,KAAP7a,CAAH,uFACX,SAACG,GAAD,OAAWA,EAAMC,MAAM6F,kBACtB,SAAC9F,GAAD,OAAWA,EAAMC,MAAM6F,kBACxB,SAAC9F,GAAD,OAAWA,EAAMC,MAAMC,QAAQE,gBAGpCua,GAAe9a,YAAO+a,KAAP/a,CAAH,qJAEM,SAACG,GAAD,OAAWA,EAAMC,MAAMC,QAAQa,SAC1C,SAACf,GAAD,OAAWA,EAAMC,MAAMC,QAAQE,gBAatCya,GAAoC,SAAC,GAAsC,IAAD,IAApCC,EAAoC,EAApCA,iBAAkBC,EAAkB,EAAlBA,aACtDjY,EAAUmT,KAChB,EAAoC9Y,IAAMO,UAAS,GAAnD,mBAAO6Y,EAAP,KAAmByE,EAAnB,KACA,EAAkD7d,IAAMO,UAAS,GAAjE,mBAAOud,EAAP,KAA0BC,EAA1B,KACA,EAA4C/d,IAAMO,UAAS,GAA3D,mBAAOyd,EAAP,KAAuBC,EAAvB,KAEAje,IAAMS,WAAU,WACW,SAArBkd,GAA6BE,GAAc,GACtB,UAArBF,GAA8BE,GAAc,GAC3CF,GAAkBE,GAAc,KACpC,CAACF,IAQJ,OACE,eAACH,GAAD,CACEpU,QAAQ,YACRpD,UAAWkY,aAAKvY,EAAQsT,QAAT,oBACZtT,EAAQyT,WAAaA,GADT,eAEZzT,EAAQiU,aAAeR,GAFX,IAIfzT,QAAS,CACPwY,MAAOD,cAAI,oBACRvY,EAAQyT,WAAaA,GADb,eAERzT,EAAQiU,aAAeR,GAFf,KAPf,UAaE,sBAAKpT,UAAWL,EAAQqU,SAAxB,UACGZ,GAAc,qBAAKpT,UAAWL,EAAQoU,UAAxB,0BACf,cAACsB,GAAA,EAAD,CAASC,MAAOlC,EAAa,aAAe,YAAarT,UAAU,QAAnE,SACE,cAACuX,GAAD,CAAkBc,eAAa,EAACnV,QAvBnB,kBAAM4U,GAAc,SAACQ,GAAD,OAAWA,MAuB5C,SACGjF,EAAa,cAAC,KAAD,IAAoB,cAAC,KAAD,WAKxC,cAACwC,GAAA,EAAD,IAEA,cAAC,GAAD,aACExC,WAAYA,EACZuB,wBA/B0B,kBAAMoD,GAAqB,IAgCrDnD,qBA9BuB,kBAAMqD,GAAkB,KA+B3CL,IAGN,cAAC,GAAD,CAAe/X,KAAMiY,EAAmBxR,YAAa,kBAAMyR,GAAqB,MAEhF,cAAC,GAAD,CAAYlY,KAAMmY,EAAgB1R,YAAa,kBAAM2R,GAAkB,UAW9DK,GANY,SAACzb,GAAD,OACzB,cAACoH,GAAkBoD,SAAnB,UACG,SAACkR,GAAD,OAAmD,cAAC,GAAD,2BAAgB1b,GAAhB,IAAuB+a,aAAcW,SC/EvFC,GAAS9b,YAAO+b,IAAP/b,CAAH,4BAENgc,GAAehc,IAAOC,IAAV,qPAGQgc,GASpBC,GAAiBlc,IAAOC,IAAV,mWAEE,SAACE,GAAD,OAAWA,EAAMC,MAAMC,QAAQ+D,QAe/C4B,GAAUhG,YAAOkc,GAAPlc,CAAH,qHACI,SAACG,GAAD,OAAWA,EAAMC,MAAM6F,kBAclCkW,GAA0C,SAAC,GAAyB,IAAxB1e,EAAuB,EAAvBA,SAAUD,EAAa,EAAbA,QAC1D,EAAwCK,qBAAxC,mBAAOuI,EAAP,KAAqBgW,EAArB,KACA,EAAgDve,qBAAhD,mBAAOod,EAAP,KAAyBoB,EAAzB,KAEAte,qBAAU,YACU,WAChB,IAAMue,EAAaniB,EAASqb,WACtB+G,EAAQ,aACZ3V,GAAIpJ,EACJmJ,MAAM,GAAD,OAAK7L,MACPW,KAGD+gB,EAAcF,EAAWzY,IAAX,UAAkBpG,EAAlB,YAA8BD,IAEhDgf,EAAY5J,IAAI2J,GAChBC,EAAYC,eAAeC,SAC3BN,EAAgBG,GAGlBI,KACC,CAACnf,EAASC,IAEbmf,2BAAgB,WACVle,eAAeC,QAAQ/B,KACzB0C,YACE,2FAEE,uBACA,iHAEF,CACEmZ,WAAW,EACXvc,KAAM,YAGVwC,eAAeoN,WAAWlP,MAE3B,IAEH,IAAMigB,EAAOC,YAAW,CACtBC,UAAW,SAAC7T,GACV,GACEA,EAAM6D,MAAMrE,SAAWlC,SAASC,eAAetJ,IAC/C+L,EAAM6D,MAAMrE,SAAWlC,SAASC,eAAerJ,GAFjD,CAKA,IAAI4f,EAAY3hB,KAAK4hB,KAAK/T,EAAMgU,SAAS,IACrCC,EAAY9hB,KAAK4hB,KAAK/T,EAAMgU,SAAS,IACzB7hB,KAAK+hB,IAAIlU,EAAMgU,SAAS,IACxB,KACK,IAAfF,GAAkBX,EAAoB,QACxB,IAAdW,GAAiBX,EAAoB,UAEzB,IAAdW,GAAiC,IAAdG,GAAiBd,OAAoBgB,OAIhE,OACE,eAAC,GAAD,2BAAaR,KAAb,cACE,cAAC,GAAD,CAAY5B,iBAAkBA,IAC9B,cAAC,GAAD,CAAe7U,aAAcA,EAAc3I,SAAUA,EAAUD,QAASA,IACxE,cAACwe,GAAD,SAmBSsB,GAdQ,kBACrB,cAACjgB,EAAgBsN,SAAjB,UACG,gBAAEnN,EAAF,EAAEA,QAASC,EAAX,EAAWA,SAAX,OACCD,GAAWC,EACT,cAAC,GAAD,CAAwBD,QAASA,EAASC,SAAUA,IAEpD,cAACye,GAAD,UACE,cAACJ,GAAD,CAAQrR,MAAM,oB,2BCjITzK,gBAPsB,SAAC,GAAD,IAAEsD,EAAF,EAAEA,UAAcia,EAAhB,0BACnC,qBAAKja,UAAWA,EAAhB,SACE,cAAC,IAAD,eAAoBia,SAKqBC,MAAM,GAApCxd,CAAf,6O,oBCOMyd,I,cAA8B,SAAC,GAAgB,IAAf/V,EAAc,EAAdA,SAC9BgW,EAAcC,aAAY,CAC9B7b,QAAS,CACPzB,QAAS,CACP+D,KAAM+R,GAAgBzO,GAAUrH,QAAQ+D,KACxC9D,KAAM6V,GAAgBzO,GAAUrH,QAAQC,MAE1CW,UAAW,CAACmD,KAAM+R,GAAgBzO,GAAUzG,UAAUmD,SAI1D,OACE,cAAC,IAAD,CACEhE,MAAK,2BACAA,IACA+V,GAAgBzO,IAHvB,SAME,eAAC,KAAD,CAAkBtH,MAAOsd,EAAzB,UACE,cAAC,GAAD,IACA,cAACE,GAAD,CACEvb,SAAS,YACToW,UAAW,IACXoF,kBAAkB,EAClBC,aAAa,EACbC,cAAY,EACZC,iBAAe,EACfC,KAAK,EACLC,WAAS,WAiBJC,GAVH,kBACV,cAAC,EAAD,UACE,cAAC,GAAD,UACE,cAAC5W,GAAkBoD,SAAnB,UACG,gBAAEjD,EAAF,EAAEA,SAAF,OAA4C,cAAC,GAAD,CAAYA,SAAUA,YC5CvD0W,QACW,cAA7BxiB,OAAO+P,SAAS0S,UAEe,UAA7BziB,OAAO+P,SAAS0S,UAEhBziB,OAAO+P,SAAS0S,SAASC,MAAM,2DCfnC,IAYeC,GAZS,SAACC,GACnBA,GAAeA,aAAuBC,UACxC,8BAAqBngB,MAAK,YAAgD,IAA9CogB,EAA6C,EAA7CA,OAAQC,EAAqC,EAArCA,OAAQC,EAA6B,EAA7BA,OAAQC,EAAqB,EAArBA,OAAQC,EAAa,EAAbA,QAC1DJ,EAAOF,GACPG,EAAOH,GACPI,EAAOJ,GACPK,EAAOL,GACPM,EAAQN,OCFdO,IAASC,OACP,cAAC,IAAMC,WAAP,UACE,cAAC,GAAD,MAEFzY,SAASC,eAAe,SFsHpB,kBAAmB5K,WACrBA,UAAUqjB,cAAcC,MACrB7gB,MAAK,SAAC8gB,GACLA,EAAaC,gBAEdhgB,OAAM,SAACE,GACNoN,QAAQpN,MAAMA,EAAM+f,YEjH5Bf,O","file":"static/js/main.2d413719.chunk.js","sourcesContent":["import firebase from 'firebase/app';\nimport 'firebase/firestore';\nimport 'firebase/database';\nimport 'firebase/auth';\n\nexport const config = {\n  apiKey: process.env.REACT_APP_FIREBASE_API_KEY,\n  authDomain: process.env.REACT_APP_FIREBASE_AUTH_DOMAIN,\n  databaseURL: process.env.REACT_APP_FIREBASE_DATABASE_URL,\n  projectId: process.env.REACT_APP_FIREBASE_PROJECT_ID,\n  storageBucket: process.env.REACT_APP_FIREBASE_STORAGE_BUCKET,\n  messagingSenderId: process.env.REACT_APP_FIREBASE_MESSAGING_SENDER_ID,\n  appId: process.env.REACT_APP_FIREBASE_APP_ID,\n};\n\nfirebase.initializeApp(config);\n\nexport default firebase;\n","const emojiArr: string[] = [];\n\nconst getRandomFaceEmoji = () => {\n  let targetEmoji: string;\n  for (let i = 0x1f600; i <= 0x1f64f; i += 1) emojiArr.push(String.fromCodePoint(i));\n  let random = Math.floor(Math.random() * emojiArr.length);\n  targetEmoji = emojiArr[random];\n  emojiArr.splice(random, 1);\n  return targetEmoji;\n};\n\nexport default getRandomFaceEmoji;\n","import * as Bowser from 'bowser';\n\nconst detectOS = () => {\n  const parsedAgent = Bowser.parse(window.navigator.userAgent);\n\n  return {\n    browser: parsedAgent.browser.name || 'unknown',\n    platform: parsedAgent.platform.type || 'unknown',\n  };\n};\n\nexport default detectOS;\n","export default __webpack_public_path__ + \"static/media/backgroundRipple.48d86bdf.svg\";","const pcConfig = {\n  iceServers: [\n    {\n      urls: ['stun:stun1.l.google.com:19302', 'stun:stun2.l.google.com:19302'],\n    },\n  ],\n  iceCandidatePoolSize: 10,\n};\n\nexport default pcConfig;\n","export const ROOT_COLLECTION = 'transferRooms';\nexport const CONNECTIONS = 'connections';\nexport const CALLEE = 'calleeCandidates';\nexport const CALLER = 'callerCandidates';\nexport const FILE_METAS = 'fileMetas';\n","export const DATA_CHANNEL_TIMEOUT = 'dataChannelTimeout';\nexport const WAIT_REMOTE_DESC = 'waitRemoteDesc';\nexport const PUBLIC_ID = 'publicID';\n","export const APP_THEME = 'appTheme';\nexport const APP_AUTO_ACCEPT = 'appAutoAccept';\nexport const APP_AUTO_DOWNLOAD = 'appAutoDownload';\n","export const MIN_CHUNK_SIZE = 16384; // 16kib\nexport const MAXIMUM_FILE_BYTE = 16777216; // 16mib\nexport const MAXIMUM_BUFFER_BYTE = 16777216; // 16mib\nexport const MAXIMUM_FILE_NUMBER = 5;\nexport const MAXIMUM_PEER_NUMBER = 10;\n","export const ELE_PUBLIC_ID = 'public-id';\nexport const ELE_PUBLIC_ID_WRAPPER = 'public-id-wrapper';\n","import React, {useEffect} from 'react';\nimport firebase from 'src/services/firebase';\nimport {toast} from 'react-toastify';\nimport {v4 as uuidv4} from 'uuid';\nimport pcConfig from 'src/services/rtcPeerConnectionConfig';\nimport {PUBLIC_ID} from 'src/constants';\n\nexport interface IIdentityContextVariable {\n  localID: string;\n  publicID: string;\n  setPublicID: React.Dispatch<React.SetStateAction<string>>;\n}\n\nexport const IdentityContext = React.createContext<IIdentityContextVariable>({\n  localID: '',\n  publicID: '',\n  setPublicID: () => undefined,\n});\n\ninterface Props {\n  children?: React.ReactNode;\n}\n\nconst IdentityProvider = ({children}: React.PropsWithChildren<Props>) => {\n  const [localID, setLocalID] = React.useState<string>('');\n  const [publicID, setPublicID] = React.useState<string>('');\n\n  useEffect(() => {\n    let publicIP: string;\n    let channel: RTCDataChannel | null;\n    let pc: RTCPeerConnection | null = new RTCPeerConnection(pcConfig);\n    channel = pc.createDataChannel('');\n    pc.createOffer().then((offer) => pc?.setLocalDescription(offer));\n\n    let sessionPublicID = sessionStorage.getItem(PUBLIC_ID);\n\n    pc.onicecandidate = (ice) => {\n      if (!ice || !ice.candidate || !ice.candidate.candidate) {\n        if (channel) channel.close();\n        channel = null;\n        pc?.close();\n        pc = null;\n        return;\n      }\n      let split = ice.candidate.candidate.split(' ');\n      if (split[7] !== 'host') {\n        if (sessionPublicID) {\n          setPublicID(sessionPublicID);\n          return;\n        }\n        if (!publicIP) setPublicID(btoa(split[4]));\n        publicIP = split[4];\n      }\n    };\n    firebase\n      .auth()\n      .signInAnonymously()\n      .then(() => setLocalID(uuidv4()))\n      .catch(() => toast.error('Failed to connect to firebase, please check your internet connection and try again'));\n  }, []);\n\n  return (\n    <IdentityContext.Provider\n      value={{\n        localID,\n        publicID,\n        setPublicID,\n      }}\n    >\n      {children}\n    </IdentityContext.Provider>\n  );\n};\n\nexport default IdentityProvider;\n","const size = {\n  xs: '320px',\n  sm: '768px',\n  lg: '1200px',\n};\n\nconst breakpoints = {\n  xs: `max-width: ${size.xs}`,\n  sm: `max-width: ${size.sm}`,\n  lg: `max-width: ${size.lg}`,\n};\n\nexport default breakpoints;\n","import styled from 'styled-components';\nimport breakpoints from 'src/styles/breakpoints';\n\nconst StyledPeerPosition = styled.div`\n  .peerHolder {\n    border-radius: 50%;\n    width: 64px;\n    height: 64px;\n    position: absolute;\n    z-index: 1;\n    @media only screen and (${breakpoints.sm}) {\n      position: relative;\n      bottom: unset !important;\n      left: unset !important;\n      right: unset !important;\n      transform: unset !important;\n      margin-left: auto;\n      margin-right: auto;\n      margin-bottom: 3em;\n    }\n  }\n  & .peerHolder:nth-child(1) {\n    bottom: 33%;\n    left: 50%;\n    transform: translateX(-50%);\n  }\n  & .peerHolder:nth-child(2) {\n    bottom: 20%;\n    left: 30%;\n  }\n  & .peerHolder:nth-child(3) {\n    bottom: 20%;\n    right: 30%;\n  }\n  & .peerHolder:nth-child(4) {\n    bottom: 58%;\n    left: 50%;\n    transform: translateX(-50%);\n  }\n  & .peerHolder:nth-child(5) {\n    bottom: 30%;\n    left: 20%;\n  }\n  & .peerHolder:nth-child(6) {\n    bottom: 30%;\n    right: 20%;\n  }\n  & .peerHolder:nth-child(7) {\n    bottom: 10%;\n    left: 15%;\n  }\n  & .peerHolder:nth-child(8) {\n    bottom: 10%;\n    right: 15%;\n  }\n  & .peerHolder:nth-child(9) {\n    bottom: 44%;\n    left: 35%;\n  }\n  & .peerHolder:nth-child(10) {\n    bottom: 44%;\n    right: 35%;\n  }\n`;\n\nexport default StyledPeerPosition;\n","import styled from 'styled-components';\nimport {Button} from '@material-ui/core';\n\nexport const PopperContentWrapper = styled.div`\n  max-width: 400px;\n  min-width: 200px;\n  overflow: auto;\n  text-align: left;\n  padding: 14px;\n  user-select: none;\n  background-color: ${(props) => props.theme.primary.dark};\n  color: ${(props) => props.theme.primary.contrastText};\n  border-radius: 8px;\n`;\n\nexport const ContentTitle = styled.div`\n  font-size: calc(8px + 1vmin);\n  min-width: max-content;\n`;\n\nexport const ContentText = styled.div`\n  font-size: calc(10px + 0.6vmin) !important;\n  line-height: 1.5em;\n  white-space: pre-wrap;\n  word-wrap: break-word;\n`;\n\nexport const ContentBody = styled.div`\n  margin-top: 16px;\n  margin-bottom: 16px;\n  max-height: 320px;\n  min-height: 60px;\n  overflow-y: auto;\n  overflow-x: hidden;\n`;\n\nexport const ContentFooter = styled.div`\n  display: flex;\n  flex-direction: row-reverse;\n`;\n\nexport const StyledPopperButton = styled(Button)`\n  margin-left: 8px !important;\n`;\n\nexport const DownloadLinksHolder = styled.div``;\n\nexport const StyledDownloadLink = styled.a`\n  min-width: max-content;\n  line-height: 1.5em;\n  white-space: pre-wrap;\n  word-wrap: break-word;\n  color: ${(props) => props.theme.secondary.light};\n`;\n","import {makeStyles} from '@material-ui/core/styles';\n\nconst usePopperStyles = makeStyles((theme) => ({\n  popper: {\n    zIndex: 99,\n    '&[x-placement*=\"top\"]': {\n      top: '-8px !important',\n    },\n    '&[x-placement*=\"bottom\"] $arrow': {\n      top: 0,\n      left: 0,\n      marginTop: '-0.9em',\n      width: '3em',\n      height: '1em',\n      '&::before': {\n        borderWidth: '0 1em 1em 1em',\n        borderColor: `transparent transparent ${theme.palette.primary.dark} transparent`,\n      },\n    },\n    '&[x-placement*=\"top\"] $arrow': {\n      bottom: 0,\n      left: 0,\n      marginBottom: '-0.9em',\n      width: '3em',\n      height: '1em',\n      '&::before': {\n        borderWidth: '1em 1em 0 1em',\n        borderColor: `${theme.palette.primary.dark} transparent transparent transparent`,\n      },\n    },\n    '&[x-placement*=\"right\"] $arrow': {\n      left: 0,\n      marginLeft: '-0.9em',\n      height: '3em',\n      width: '1em',\n      '&::before': {\n        borderWidth: '1em 1em 1em 0',\n        borderColor: `transparent ${theme.palette.primary.dark} transparent transparent`,\n      },\n    },\n    '&[x-placement*=\"left\"] $arrow': {\n      right: 0,\n      marginRight: '-0.9em',\n      height: '3em',\n      width: '1em',\n      '&::before': {\n        borderWidth: '1em 0 1em 1em',\n        borderColor: `transparent transparent transparent ${theme.palette.primary.dark}`,\n      },\n    },\n  },\n  arrow: {\n    position: 'absolute',\n    fontSize: 7,\n    width: '3em',\n    height: '3em',\n    '&::before': {\n      content: '\"\"',\n      margin: 'auto',\n      display: 'block',\n      width: 0,\n      height: 0,\n      borderStyle: 'solid',\n    },\n  },\n}));\n\nexport default usePopperStyles;\n","import React from 'react';\nimport {Popper} from '@material-ui/core';\nimport {PopperContentWrapper, ContentTitle} from 'src/styles/styled-components/StyledPopperContent';\nimport usePopperStyles from 'src/styles/hooks/usePopperStyles';\nimport {EnterType} from 'src/types';\n\ninterface Props {\n  enterType: EnterType;\n  isSelf: boolean;\n  anchorElement: any;\n}\n\nconst DropzoneTooltipPopper: React.FC<Props> = ({enterType, anchorElement, isSelf}) => {\n  const [arrowRef, setArrowRef] = React.useState<HTMLDivElement | null>(null);\n  const classes = usePopperStyles();\n\n  return (\n    <Popper\n      open={!!anchorElement && !!enterType}\n      anchorEl={anchorElement}\n      placement=\"top\"\n      className={classes.popper}\n      modifiers={{\n        flip: {\n          enabled: true,\n        },\n        preventOverflow: {\n          enabled: true,\n          boundariesElement: 'scrollParent',\n        },\n        arrow: {\n          element: arrowRef,\n        },\n      }}\n    >\n      <div className={classes.arrow} ref={setArrowRef} />\n      <PopperContentWrapper>\n        <ContentTitle>\n          {enterType === 'drag' && 'Drop here to send files'}\n          {enterType === 'mouse' && `Click here to ${isSelf ? 'send to all' : 'send files'}`}\n        </ContentTitle>\n      </PopperContentWrapper>\n    </Popper>\n  );\n};\n\nexport default DropzoneTooltipPopper;\n","import {rgba} from 'polished';\nimport styled, {keyframes} from 'styled-components';\nimport {Button} from '@material-ui/core';\n\nconst rippleColor = rgba('#468266', 0.3);\n\nconst normalCircleRipple = keyframes`\n  0% {\n    box-shadow: \n      0 0 0 0 ${rippleColor}, \n      0 0 0 0.5em ${rippleColor};\n  }\n  100% {\n    box-shadow:\n      0 0 0 0.5em ${rippleColor}, \n      0 0 0 1.5em transparent;\n  }\n`;\n\nconst extendCircleRipple = keyframes`\n  0% {\n    box-shadow: \n      0 0 0 0 ${rippleColor}, \n      0 0 0 1em ${rippleColor}, \n      0 0 0 2em ${rippleColor};\n  }\n  100% {\n    box-shadow:\n      0 0 0 1em ${rippleColor}, \n      0 0 0 2em ${rippleColor},\n      0 0 0 3.5em transparent;\n  }\n`;\n\nconst StyledCircleButton = styled(Button)`\n  background-color: ${(props) => props.theme.secondary.main} !important;\n  color: ${(props) => props.theme.secondary.contrastText} !important;\n  &:hover {\n    background: ${(props) => props.theme.secondary.dark} !important;\n  }\n  border-radius: 50% !important;\n  height: 64px;\n  width: 64px;\n  span.MuiButton-label {\n    font-size: 25px;\n    width: 25px;\n  }\n`;\n\nexport const PeerStyledCircleButton = styled(StyledCircleButton)`\n  animation: ${normalCircleRipple} 1s linear infinite;\n`;\n\nexport const OwnStyledCircleButton = styled(StyledCircleButton)`\n  animation: ${extendCircleRipple} 0.7s linear infinite;\n`;\n","const trimName = (name: string, length: number) => {\n  return name.length > length ? name.substring(0, length) + '...' : name;\n};\n\nexport default trimName;\n","import {FileRejection} from 'react-dropzone';\nimport {toast} from 'react-toastify';\nimport {MAXIMUM_FILE_NUMBER} from 'src/constants';\nimport trimName from 'src/utils/trimName';\n\nfunction handleFileRejectedToast(fileRejections: FileRejection[]) {\n  if (fileRejections.length > MAXIMUM_FILE_NUMBER) {\n    toast.error(`The maximum number of transfer files is set up to ${MAXIMUM_FILE_NUMBER}`);\n  } else {\n    fileRejections.forEach(({file, errors}) => {\n      toast.error(\n        `Unable to transfer ${trimName(file.name, 9)}${\n          errors.find((error) => error.code === 'file-too-large') ? '. The maximum size per file is set up to 16mb' : ''\n        }`,\n      );\n    });\n  }\n}\n\nexport default handleFileRejectedToast;\n","import React from 'react';\nimport {EnterType} from 'src/types';\nimport {useDropzone} from 'react-dropzone';\nimport {MAXIMUM_FILE_BYTE, MAXIMUM_FILE_NUMBER} from 'src/constants/numericValues';\nimport handleFileRejectedToast from 'src/utils/handleFileRejectedToast';\n\ninterface Props {\n  shouldDisableActionBtn: boolean;\n  handleFileInputChange: (files: File[]) => Promise<void> | void;\n}\n\nconst useCustomDropzone = ({shouldDisableActionBtn, handleFileInputChange}: Props) => {\n  const [enterType, setEnterType] = React.useState<EnterType>(null);\n\n  const onDragEnter = () => setEnterType('drag');\n  const onDragLeave = () => setEnterType(null);\n  const onMouseEnter = () => setEnterType('mouse');\n  const onMouseLeave = () => setEnterType(null);\n\n  const {getRootProps, getInputProps} = useDropzone({\n    maxFiles: MAXIMUM_FILE_NUMBER,\n    maxSize: MAXIMUM_FILE_BYTE,\n    disabled: shouldDisableActionBtn,\n    onDragEnter,\n    onDragLeave,\n    onDropAccepted: handleFileInputChange,\n    onDropRejected: handleFileRejectedToast,\n  });\n\n  React.useEffect(() => {\n    if (shouldDisableActionBtn) setEnterType(null);\n  }, [shouldDisableActionBtn]);\n\n  return {\n    getRootProps,\n    getInputProps,\n    onMouseEnter,\n    onMouseLeave,\n    enterType,\n  };\n};\n\nexport default useCustomDropzone;\n","import React from 'react';\nimport styled from 'styled-components';\nimport {IPeerField} from 'src/types';\nimport DropzoneTooltipPopper from 'src/components/Poppers/DropzoneTooltipPopper';\nimport {OwnStyledCircleButton} from 'src/styles/styled-components/StyledCircleButton';\nimport useCustomDropzone from 'src/components/DropZone/hooks/useCustomDropzone';\n\nconst Wrapper = styled.div`\n  z-index: 1;\n  position: fixed;\n  bottom: 1em;\n  left: 50%;\n  transform: translateX(-50%);\n  padding-left: ${(props) => props.theme.drawerMinWidth};\n`;\n\nconst IdentityWrapper = styled.div`\n  font-size: 14px;\n  color: ${(props) => props.theme.primary.contrastText};\n  text-transform: capitalize;\n`;\n\ninterface Props {\n  selfIdentity: IPeerField;\n  localID: string;\n  publicID: string;\n  shouldDisableActionBtn: boolean;\n  handleFileInputChange: (files: File[]) => void;\n}\n\nconst SelfFileDropZone: React.FC<Props> = ({selfIdentity, shouldDisableActionBtn, handleFileInputChange}) => {\n  const anchorRef = React.useRef(null);\n\n  const {getRootProps, getInputProps, onMouseEnter, onMouseLeave, enterType} = useCustomDropzone({\n    shouldDisableActionBtn,\n    handleFileInputChange,\n  });\n\n  const avatarButtonClick = () => ((document.getElementById(`fileInput-self`) as HTMLInputElement).value = '');\n\n  return (\n    <Wrapper>\n      <div {...getRootProps()}>\n        <OwnStyledCircleButton\n          className=\"peerBtn\"\n          ref={anchorRef}\n          onMouseEnter={onMouseEnter}\n          onMouseLeave={onMouseLeave}\n          onClick={avatarButtonClick}\n          variant=\"contained\"\n        >\n          <span>{selfIdentity.emoji}</span>\n          <input id={`fileInput-self`} {...getInputProps()} />\n        </OwnStyledCircleButton>\n        <IdentityWrapper>\n          You: {selfIdentity.platform}-{selfIdentity.browser}\n        </IdentityWrapper>\n      </div>\n      {'mouse' && <DropzoneTooltipPopper isSelf={true} enterType={enterType} anchorElement={anchorRef.current} />}\n    </Wrapper>\n  );\n};\n\nexport default SelfFileDropZone;\n","import React from 'react';\nimport styled from 'styled-components';\nimport {PeerStyledCircleButton} from 'src/styles/styled-components/StyledCircleButton';\nimport {IPeerField} from 'src/types';\nimport DropzoneTooltipPopper from 'src/components/Poppers/DropzoneTooltipPopper';\nimport useCustomDropzone from 'src/components/DropZone/hooks/useCustomDropzone';\n\nconst IdentityWrapper = styled.div`\n  position: relative;\n  font-size: 14px;\n  color: ${(props) => props.theme.primary.contrastText};\n  text-transform: capitalize;\n  min-width: max-content;\n  left: 50%;\n  transform: translateX(-50%);\n`;\ninterface Props {\n  shouldDisableActionBtn: boolean;\n  handleFileInputChange: (files: File[]) => Promise<void>;\n  targetPeer: IPeerField;\n  setAnchorElement: React.Dispatch<React.SetStateAction<any>>;\n}\n\nconst PeerFileDropZone: React.FC<Props> = ({\n  shouldDisableActionBtn,\n  handleFileInputChange,\n  targetPeer,\n  setAnchorElement,\n}) => {\n  const anchorRef = React.useRef(null);\n\n  const {getRootProps, getInputProps, onMouseEnter, onMouseLeave, enterType} = useCustomDropzone({\n    shouldDisableActionBtn,\n    handleFileInputChange,\n  });\n\n  React.useEffect(() => {\n    if (anchorRef.current) setAnchorElement(anchorRef.current);\n  }, [anchorRef, setAnchorElement]);\n\n  const avatarButtonClick = () =>\n    ((document.getElementById(`fileInput-${targetPeer.id}`) as HTMLInputElement).value = '');\n\n  return (\n    <>\n      <div {...getRootProps()}>\n        <PeerStyledCircleButton\n          className=\"peerBtn\"\n          ref={anchorRef}\n          disabled={shouldDisableActionBtn}\n          onMouseOver={onMouseEnter}\n          onMouseLeave={onMouseLeave}\n          onClick={avatarButtonClick}\n          variant=\"contained\"\n        >\n          <input id={`fileInput-${targetPeer.id}`} {...getInputProps()} />\n          <span>{targetPeer.emoji}</span>\n        </PeerStyledCircleButton>\n      </div>\n      <IdentityWrapper>\n        {targetPeer.platform}-{targetPeer.browser}\n      </IdentityWrapper>\n      {enterType && <DropzoneTooltipPopper isSelf={false} enterType={enterType} anchorElement={anchorRef.current} />}\n    </>\n  );\n};\n\nexport default PeerFileDropZone;\n","import styled from 'styled-components';\n\nconst Wrapper = styled.div`\n  display: flex;\n  align-items: center;\n  margin-top: 1em;\n`;\n\nconst ProgressWrapper = styled.div`\n  width: 100%;\n  margin-right: 1em;\n  flex-grow: 1;\n  --progress-color: ${(props) => props.theme.secondary.light};\n  progress {\n    width: 100%;\n    color: var(--progress-color);\n  }\n  progress[value] {\n    /* Reset the default progress */\n    -webkit-appearance: none;\n    -moz-appearance: none;\n    appearance: none;\n    border: none;\n    height: 12px;\n  }\n  progress[value]::-moz-progress-bar {\n    background-color: var(--progress-color);\n  }\n  progress::-webkit-progress-value {\n    border-radius: 4px;\n    background-color: var(--progress-color);\n  }\n  progress::-webkit-progress-bar {\n    border-radius: 4px;\n    box-shadow: 0 2px 5px rgba(0, 0, 0, 0.25) inset;\n  }\n`;\n\nconst LabelWrapper = styled.div`\n  width: 44px;\n  color: ${(props) => props.theme.secondary.light};\n`;\n\nconst LinearProgressWithLabel = (props: {progress: number}) => {\n  return (\n    <Wrapper>\n      <ProgressWrapper>\n        <progress max=\"100\" value={props.progress} />\n      </ProgressWrapper>\n      <LabelWrapper>{`${props.progress}%`}</LabelWrapper>\n    </Wrapper>\n  );\n};\n\nexport default LinearProgressWithLabel;\n","import React from 'react';\nimport {useAppTheme, useTransferSetting} from 'src/providers/hooks';\n\nexport interface IAppSettingContextVariable {\n  shouldAutoAccept: boolean;\n  shouldAutoDownload: boolean;\n  appTheme: 'light' | 'dark';\n  toggleAutoAccept: () => void;\n  toggleAutoDownload: () => void;\n  toggleLightDarkTheme: () => void;\n}\n\nexport const AppSettingContext = React.createContext<IAppSettingContextVariable>({\n  shouldAutoAccept: false,\n  shouldAutoDownload: false,\n  appTheme: 'dark',\n  toggleAutoAccept: () => undefined,\n  toggleAutoDownload: () => undefined,\n  toggleLightDarkTheme: () => undefined,\n});\n\ninterface Props {\n  children?: React.ReactNode;\n}\n\nconst AppSettingProvider = ({children}: React.PropsWithChildren<Props>) => {\n  const {shouldAutoAccept, shouldAutoDownload, toggleAutoAccept, toggleAutoDownload} = useTransferSetting();\n\n  const {appTheme, toggleLightDarkTheme} = useAppTheme();\n\n  return (\n    <AppSettingContext.Provider\n      value={{\n        shouldAutoAccept,\n        shouldAutoDownload,\n        appTheme,\n        toggleAutoAccept,\n        toggleAutoDownload,\n        toggleLightDarkTheme,\n      }}\n    >\n      {children}\n    </AppSettingContext.Provider>\n  );\n};\n\nexport default AppSettingProvider;\n","import {useEffect, useState} from 'react';\nimport {APP_AUTO_ACCEPT, APP_AUTO_DOWNLOAD} from 'src/constants';\n\nexport const useTransferSetting = () => {\n  const [shouldAutoAccept, setAutoAccept] = useState<boolean>(false);\n  const [shouldAutoDownload, setAutoDownload] = useState<boolean>(false);\n\n  const toggleAutoAccept = () => {\n    window.localStorage.setItem(APP_AUTO_ACCEPT, (!shouldAutoAccept).toString());\n    setAutoAccept(!shouldAutoAccept);\n  };\n\n  const toggleAutoDownload = () => {\n    window.localStorage.setItem(APP_AUTO_DOWNLOAD, (!shouldAutoDownload).toString());\n    setAutoDownload(!shouldAutoDownload);\n  };\n\n  useEffect(() => {\n    const appAutoAccept = window.localStorage.getItem(APP_AUTO_ACCEPT);\n    const appAutoDownload = window.localStorage.getItem(APP_AUTO_DOWNLOAD);\n\n    let acceptSetting = appAutoAccept === 'false' || !appAutoAccept ? false : true;\n    let downloadSetting = appAutoDownload === 'false' || !appAutoDownload ? false : true;\n\n    setAutoAccept(acceptSetting);\n    setAutoDownload(downloadSetting);\n  }, []);\n\n  return {\n    shouldAutoAccept,\n    shouldAutoDownload,\n    toggleAutoAccept,\n    toggleAutoDownload,\n  };\n};\n","import {useEffect, useState} from 'react';\nimport {APP_THEME} from 'src/constants';\n\ntype AppTheme = 'light' | 'dark';\n\nexport const useAppTheme = () => {\n  const [appTheme, setAppTheme] = useState<'light' | 'dark'>('dark');\n\n  const toggleLightDarkTheme = () => {\n    let target: AppTheme = appTheme === 'dark' ? 'light' : 'dark';\n    window.localStorage.setItem(APP_THEME, target);\n    setAppTheme(target);\n  };\n\n  useEffect(() => {\n    const currentTheme = window.localStorage.getItem(APP_THEME);\n    if (currentTheme) {\n      setAppTheme(currentTheme as AppTheme);\n    } else {\n      window.localStorage.setItem(APP_THEME, 'dark');\n    }\n  }, []);\n\n  return {\n    appTheme,\n    toggleLightDarkTheme,\n  };\n};\n","import React from 'react';\nimport {Popper} from '@material-ui/core';\nimport LinearProgressWithLabel from 'src/styles/styled-components/LinearProgressWithLabel';\nimport {\n  PopperContentWrapper,\n  ContentTitle,\n  ContentBody,\n  ContentFooter,\n  StyledPopperButton,\n  DownloadLinksHolder,\n  StyledDownloadLink,\n} from 'src/styles/styled-components/StyledPopperContent';\nimport usePopperStyles from 'src/styles/hooks/usePopperStyles';\nimport {IPeerField, IDownloadableFile} from 'src/types';\nimport {AppSettingContext, IAppSettingContextVariable} from 'src/providers/AppSettingProvider';\n\ninterface IProgressPopperData {\n  isOpen: boolean;\n  fileProgress: number;\n  downloadableFiles: IDownloadableFile[];\n  progressType: 'send' | 'receive' | null;\n}\n\nexport const initialProgressPopperData: IProgressPopperData = {\n  isOpen: false,\n  progressType: null,\n  fileProgress: 0,\n  downloadableFiles: [],\n};\n\nexport type ProgressPopperReducerAction =\n  | {type: 'clear'}\n  | {type: 'set_received_progress'; payload: {progress: number}}\n  | {type: 'set_sent_progress'; payload: {progress: number}}\n  | {type: 'set_downloadableFiles'; payload: {downloadableFile: IDownloadableFile}};\n\nexport const progressPopperReducer = (\n  state: IProgressPopperData,\n  action: ProgressPopperReducerAction,\n): IProgressPopperData => {\n  switch (action.type) {\n    case 'clear':\n      return {\n        ...initialProgressPopperData,\n      };\n    case 'set_received_progress':\n      return {\n        ...state,\n        isOpen: true,\n        progressType: 'receive',\n        fileProgress: action.payload.progress,\n      };\n    case 'set_sent_progress':\n      return {\n        ...state,\n        isOpen: true,\n        progressType: 'send',\n        fileProgress: action.payload.progress,\n      };\n    case 'set_downloadableFiles':\n      return {\n        ...state,\n        downloadableFiles: [...state.downloadableFiles, action.payload.downloadableFile],\n      };\n    default:\n      return state;\n  }\n};\n\ninterface Props extends IProgressPopperData {\n  targetPeer: IPeerField;\n  onCancelFileTransfer: () => void;\n  setClose: () => void;\n  anchorElement: any;\n}\n\ninterface IProgressPopper extends Props {\n  shouldAutoDownload: boolean;\n}\n\nconst ProgressPopper: React.FC<IProgressPopper> = ({\n  targetPeer,\n  setClose,\n  fileProgress,\n  downloadableFiles,\n  progressType,\n  anchorElement,\n  onCancelFileTransfer,\n  shouldAutoDownload,\n}) => {\n  const [arrowRef, setArrowRef] = React.useState<HTMLDivElement | null>(null);\n  const [receivedFiles, setReceivedFiles] = React.useState<IDownloadableFile[] | null>(null);\n  const classes = usePopperStyles();\n\n  React.useEffect(() => {\n    setReceivedFiles(downloadableFiles);\n  }, [downloadableFiles]);\n\n  React.useEffect(() => {\n    if (shouldAutoDownload && fileProgress === 100) setClose();\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [shouldAutoDownload, fileProgress]);\n\n  const handleDownloadClick = (file: IDownloadableFile) => {\n    setTimeout(() => window.URL.revokeObjectURL(file.fileBlobUrl), 0);\n    let filteredFiles = receivedFiles!.filter((prevFile) => prevFile.fileBlobUrl !== file.fileBlobUrl);\n\n    if (filteredFiles.length > 0) {\n      setReceivedFiles(filteredFiles);\n    } else {\n      setClose();\n    }\n  };\n\n  const handleCancel = () => {\n    onCancelFileTransfer();\n    handleClose();\n  };\n\n  const handleClose = () => setClose();\n\n  return (\n    <Popper\n      open={!!anchorElement}\n      anchorEl={anchorElement}\n      placement=\"top\"\n      className={classes.popper}\n      modifiers={{\n        flip: {\n          enabled: true,\n        },\n        preventOverflow: {\n          enabled: true,\n          boundariesElement: 'scrollParent',\n        },\n        arrow: {\n          element: arrowRef,\n        },\n      }}\n    >\n      <div className={classes.arrow} ref={setArrowRef} />\n      <PopperContentWrapper>\n        {progressType === 'receive' ? (\n          <>\n            <ContentTitle>\n              {shouldAutoDownload ? 'Download Progress: ' : 'Downloadable file will show below'}\n            </ContentTitle>\n            <ContentBody>\n              {receivedFiles &&\n                receivedFiles.map((file, i) => (\n                  <DownloadLinksHolder key={`${targetPeer.id}-download-${i}`}>\n                    <StyledDownloadLink\n                      onClick={() => handleDownloadClick(file)}\n                      download={file.fileName}\n                      href={file.fileBlobUrl}\n                    >\n                      Download {file.fileName}\n                    </StyledDownloadLink>\n                  </DownloadLinksHolder>\n                ))}\n              {fileProgress !== 0 && <LinearProgressWithLabel progress={fileProgress} />}\n            </ContentBody>\n            <ContentFooter>\n              {fileProgress === 100 ? (\n                <StyledPopperButton variant=\"outlined\" size=\"small\" onClick={handleClose} color=\"secondary\">\n                  close\n                </StyledPopperButton>\n              ) : (\n                <StyledPopperButton variant=\"outlined\" size=\"small\" onClick={handleCancel} color=\"secondary\">\n                  cancel\n                </StyledPopperButton>\n              )}\n            </ContentFooter>\n          </>\n        ) : (\n          <>\n            <ContentTitle>Sending...</ContentTitle>\n            <ContentBody>\n              <div>Waiting for file transfer to complete...</div>\n              <LinearProgressWithLabel progress={fileProgress} />\n            </ContentBody>\n            <ContentFooter>\n              <StyledPopperButton variant=\"outlined\" onClick={handleCancel} color=\"secondary\">\n                cancel\n              </StyledPopperButton>\n            </ContentFooter>\n          </>\n        )}\n      </PopperContentWrapper>\n    </Popper>\n  );\n};\n\nconst ConsumedProgressPopper = (props: Props) => (\n  <AppSettingContext.Consumer>\n    {({shouldAutoDownload}: IAppSettingContextVariable) => (\n      <ProgressPopper {...props} shouldAutoDownload={shouldAutoDownload} />\n    )}\n  </AppSettingContext.Consumer>\n);\n\nexport default ConsumedProgressPopper;\n","const readableBytes = (size: number, toFixed: number = 2) => {\n  if (size === 0) return '0 B';\n  let i = Math.floor(Math.log(size) / Math.log(1024));\n  return (size / Math.pow(1024, i)).toFixed(toFixed) + ' ' + ['B', 'Kib', 'Mib', 'Gib', 'Tib'][i];\n};\n\nexport default readableBytes;\n","import React from 'react';\nimport {Popper} from '@material-ui/core';\nimport {\n  PopperContentWrapper,\n  ContentTitle,\n  ContentBody,\n  ContentText,\n  ContentFooter,\n  StyledPopperButton,\n} from 'src/styles/styled-components/StyledPopperContent';\nimport usePopperStyles from 'src/styles/hooks/usePopperStyles';\nimport {IFileMeta, IPeerField} from 'src/types';\nimport readableBytes from 'src/utils/readableBytes';\n\ninterface INotifyOfferPopperData {\n  isOpen: boolean;\n  fileMetas: IFileMeta[] | null;\n}\n\nexport const initialNotifyOfferPopperData: INotifyOfferPopperData = {\n  isOpen: false,\n  fileMetas: null,\n};\n\nexport type NotifyOfferPopperReducerAction =\n  | {type: 'clear'}\n  | {type: 'set_file_metas'; payload: {fileMetas: IFileMeta[]}};\n\nexport const notifyOfferPopperReducer = (\n  state: INotifyOfferPopperData,\n  action: NotifyOfferPopperReducerAction,\n): INotifyOfferPopperData => {\n  switch (action.type) {\n    case 'clear':\n      return {\n        ...initialNotifyOfferPopperData,\n      };\n    case 'set_file_metas':\n      return {\n        isOpen: true,\n        fileMetas: action.payload.fileMetas,\n      };\n    default:\n      return state;\n  }\n};\n\ninterface Props extends INotifyOfferPopperData {\n  targetPeer: IPeerField;\n  onCancelFileTransfer: () => void;\n  onAcceptFileTransfer: () => void;\n  setClose: () => void;\n  anchorElement: any;\n}\n\nconst NotifyOfferPopper: React.FC<Props> = ({\n  setClose,\n  anchorElement,\n  fileMetas,\n  targetPeer,\n  onCancelFileTransfer,\n  onAcceptFileTransfer,\n}) => {\n  const [arrowRef, setArrowRef] = React.useState<HTMLDivElement | null>(null);\n  const classes = usePopperStyles();\n\n  const handleDecline = () => {\n    onCancelFileTransfer();\n    setClose();\n  };\n\n  const handleAccept = () => {\n    onAcceptFileTransfer();\n    setClose();\n  };\n\n  return (\n    <Popper\n      open={!!anchorElement}\n      anchorEl={anchorElement}\n      placement=\"top\"\n      className={classes.popper}\n      modifiers={{\n        flip: {\n          enabled: true,\n        },\n        preventOverflow: {\n          enabled: true,\n          boundariesElement: 'scrollParent',\n        },\n        arrow: {\n          element: arrowRef,\n        },\n      }}\n    >\n      <div className={classes.arrow} ref={setArrowRef} />\n      <PopperContentWrapper>\n        <ContentTitle>\n          {targetPeer.emoji} from {targetPeer.platform} {targetPeer.browser} wants to send:\n        </ContentTitle>\n        <ContentBody>\n          {fileMetas?.map((fileMeta, i) => (\n            <ContentText key={`${targetPeer.id}-meta-${i}`}>\n              {fileMeta!.name} ({readableBytes(fileMeta!.size)})\n            </ContentText>\n          ))}\n        </ContentBody>\n        <ContentFooter>\n          <StyledPopperButton variant=\"contained\" size=\"small\" onClick={handleAccept} color=\"secondary\">\n            Accept\n          </StyledPopperButton>\n          <StyledPopperButton variant=\"outlined\" size=\"small\" onClick={handleDecline} color=\"secondary\">\n            Decline\n          </StyledPopperButton>\n        </ContentFooter>\n      </PopperContentWrapper>\n    </Popper>\n  );\n};\n\nexport default NotifyOfferPopper;\n","import React from 'react';\nimport {Popper} from '@material-ui/core';\nimport {PopperContentWrapper, ContentTitle} from 'src/styles/styled-components/StyledPopperContent';\nimport usePopperStyles from 'src/styles/hooks/usePopperStyles';\nimport {IPeerField} from 'src/types';\nimport {DATA_CHANNEL_TIMEOUT, WAIT_REMOTE_DESC} from 'src/constants';\n\ninterface IWaitResponsePopperData {\n  isOpen: boolean;\n  gotRemoteDesc: boolean;\n}\n\nexport const initialWaitResponsePopperData: IWaitResponsePopperData = {\n  isOpen: false,\n  gotRemoteDesc: false,\n};\n\nexport type WaitResponsePopperReducerAction =\n  | {type: 'clear'}\n  | {type: 'set_open_with_desc'}\n  | {type: 'set_open_without_desc'}\n  | {type: 'set_desc'};\n\nexport const waitResponsePopperReducer = (\n  state: IWaitResponsePopperData,\n  action: WaitResponsePopperReducerAction,\n): IWaitResponsePopperData => {\n  switch (action.type) {\n    case 'clear':\n      return {\n        ...initialWaitResponsePopperData,\n      };\n    case 'set_open_with_desc':\n      return {\n        isOpen: true,\n        gotRemoteDesc: true,\n      };\n\n    case 'set_open_without_desc':\n      return {\n        isOpen: true,\n        gotRemoteDesc: false,\n      };\n    case 'set_desc':\n      return {\n        ...state,\n        gotRemoteDesc: true,\n      };\n    default:\n      return state;\n  }\n};\n\ninterface Props extends IWaitResponsePopperData {\n  targetPeer: IPeerField;\n  anchorElement: any;\n}\n\nconst WaitResponsePopper: React.FC<Props> = ({targetPeer, gotRemoteDesc, anchorElement}) => {\n  const [arrowRef, setArrowRef] = React.useState<HTMLDivElement | null>(null);\n  const classes = usePopperStyles();\n\n  React.useEffect(() => {\n    sessionStorage.setItem(WAIT_REMOTE_DESC, '1');\n    let timeoutReload: NodeJS.Timeout;\n    if (gotRemoteDesc) {\n      timeoutReload = setTimeout(() => {\n        sessionStorage.setItem(DATA_CHANNEL_TIMEOUT, '1');\n        window.location.reload();\n      }, 6000);\n    }\n    return () => {\n      clearTimeout(timeoutReload);\n      sessionStorage.removeItem(WAIT_REMOTE_DESC);\n    };\n  }, [gotRemoteDesc]);\n\n  return (\n    <Popper\n      open={!!anchorElement}\n      anchorEl={anchorElement}\n      placement=\"top\"\n      className={classes.popper}\n      modifiers={{\n        flip: {\n          enabled: true,\n        },\n        preventOverflow: {\n          enabled: true,\n          boundariesElement: 'scrollParent',\n        },\n        arrow: {\n          element: arrowRef,\n        },\n      }}\n    >\n      <div className={classes.arrow} ref={setArrowRef} />\n      <PopperContentWrapper>\n        <ContentTitle>\n          {gotRemoteDesc\n            ? `Preparing data channel with ${targetPeer.emoji}...`\n            : `Waiting for ${targetPeer.emoji}'s response...`}\n        </ContentTitle>\n      </PopperContentWrapper>\n    </Popper>\n  );\n};\n\nexport default WaitResponsePopper;\n","import {useRef, useCallback} from 'react';\nimport firebase from 'src/services/firebase';\nimport {CALLEE, CALLER, CONNECTIONS, ROOT_COLLECTION} from 'src/constants';\nimport {IFileMeta} from 'src/types';\nimport {toast} from 'react-toastify';\nimport pcConfig from 'src/services/rtcPeerConnectionConfig';\nimport {ProgressPopperReducerAction} from './Poppers/ProgressPopper';\nimport {WaitResponsePopperReducerAction} from './Poppers/WaitResponsePopper';\n\ninterface Props {\n  publicID: string;\n  firestoreDbRef: firebase.firestore.Firestore;\n  connectionIdRef: React.MutableRefObject<string | null>;\n  peerConnectionRef: React.MutableRefObject<RTCPeerConnection | null>;\n  callerUnsubscriberRef: React.MutableRefObject<(() => void) | undefined>;\n  dispatchProgressPopperData: (value: ProgressPopperReducerAction) => void;\n  dispatchWaitResponsePopperData: (value: WaitResponsePopperReducerAction) => void;\n  handleDownloadFile: (receivedBlob: Blob, name: string) => void;\n  clearSignalService: () => Promise<void>;\n}\n\nconst useJoinTransferChannel = ({\n  publicID,\n  firestoreDbRef,\n  connectionIdRef,\n  peerConnectionRef,\n  callerUnsubscriberRef,\n  dispatchProgressPopperData,\n  dispatchWaitResponsePopperData,\n  handleDownloadFile,\n  clearSignalService,\n}: Props) => {\n  const receiveChannelRef = useRef<RTCDataChannel | null>(null);\n\n  const closeReceiveDataChannel = useCallback(() => {\n    dispatchWaitResponsePopperData({type: 'clear'});\n    if (receiveChannelRef.current) {\n      receiveChannelRef.current.close();\n      console.log(`Closed receive data channel with label: ${receiveChannelRef.current.label}`);\n    }\n    clearSignalService();\n  }, [receiveChannelRef, dispatchWaitResponsePopperData, clearSignalService]);\n\n  const createReceiveDataChannel = useCallback(() => {\n    peerConnectionRef.current!.ondatachannel = receiveChannelCallback;\n\n    const roomRef = firestoreDbRef.collection(ROOT_COLLECTION).doc(publicID);\n    const connectionRef = roomRef.collection(CONNECTIONS).doc(connectionIdRef.current as string);\n\n    let completeFlag = 0;\n    let receivedSize = 0;\n    let targetFileIndex = 0;\n    let targetFileSize = 0;\n    let receiveBuffer: ArrayBuffer[] = [];\n\n    function receiveChannelCallback(event: RTCDataChannelEvent) {\n      console.log('Receive Channel Callback');\n      receiveChannelRef.current = event.channel;\n      receiveChannelRef.current.binaryType = 'arraybuffer';\n      receiveChannelRef.current.onmessage = onReceiveMessageCallback;\n      receiveChannelRef.current.onopen = onReceiveChannelStateChange;\n      receiveChannelRef.current.onclose = onReceiveChannelStateChange;\n    }\n\n    async function onReceiveMessageCallback(event: MessageEvent<ArrayBuffer>) {\n      const connectionSnapShot = await connectionRef.get();\n      if (!connectionSnapShot.data()) return;\n\n      // console.log(`Received Message ${event.data.byteLength}`);\n      // console.log(event.data);\n\n      receiveBuffer.push(event.data);\n      receivedSize += event.data.byteLength;\n      targetFileSize += event.data.byteLength;\n\n      const fileMetas = connectionSnapShot.data()!.fileMetas as IFileMeta[];\n      const totalSize = fileMetas.reduce((acc, file) => acc + file.size, 0);\n\n      let {name, size} = fileMetas[targetFileIndex];\n      let receivedValue = Math.round((receivedSize / totalSize) * 100);\n\n      dispatchProgressPopperData({\n        type: 'set_received_progress',\n        payload: {progress: receivedValue},\n      });\n\n      // chunk size sent up to a exact file size in order, set to next\n      if (targetFileSize === size) {\n        const received = new Blob(receiveBuffer);\n        receiveBuffer = [];\n        targetFileSize = 0;\n        targetFileIndex += 1;\n\n        handleDownloadFile(received, name);\n      }\n      if (receivedSize === totalSize) {\n        completeFlag = 1;\n        closeReceiveDataChannel();\n      }\n    }\n\n    async function onReceiveChannelStateChange() {\n      // console.log(receiveChannelRef.current);\n      // console.log(receiveChannelRef.current);\n      if (receiveChannelRef.current) {\n        const readyState = receiveChannelRef.current.readyState;\n        console.log(`Receive channel state is: ${readyState}`);\n        if (readyState === 'open') {\n          dispatchWaitResponsePopperData({type: 'clear'});\n        }\n        if (readyState === 'closed') {\n          if (!completeFlag) toast.warn('File transfer is cancelled');\n          completeFlag = 0;\n          receiveChannelRef.current = null;\n        }\n      }\n    }\n  }, [\n    connectionIdRef,\n    firestoreDbRef,\n    peerConnectionRef,\n    receiveChannelRef,\n    publicID,\n    dispatchProgressPopperData,\n    dispatchWaitResponsePopperData,\n    handleDownloadFile,\n    closeReceiveDataChannel,\n  ]);\n\n  const joinTransferChannel = async (connectionID: string) => {\n    const roomRef = firestoreDbRef.collection(ROOT_COLLECTION).doc(publicID);\n    const connectionRef = roomRef.collection(CONNECTIONS).doc(connectionID);\n    const connectionSnapshot = await connectionRef.get();\n\n    if (connectionSnapshot.exists) {\n      connectionIdRef.current = connectionID;\n      peerConnectionRef.current = new RTCPeerConnection(pcConfig);\n\n      // set up receive data channel and listeners\n      createReceiveDataChannel();\n\n      // Code for collecting ICE candidates\n      const calleeCandidatesCollection = connectionRef.collection(CALLEE);\n      peerConnectionRef.current.addEventListener('icecandidate', (event) => {\n        if (!event.candidate) {\n          console.log('Got final candidate!');\n          return;\n        }\n        // console.log('Got candidate: ', event.candidate);\n        calleeCandidatesCollection.add(event.candidate.toJSON());\n      });\n\n      // Creating SDP answer and update remote\n      const offer = connectionSnapshot!.data()!.offer;\n      console.log('Got offer:', offer);\n      await peerConnectionRef.current.setRemoteDescription(new RTCSessionDescription(offer));\n\n      const answer = await peerConnectionRef.current.createAnswer();\n      console.log('Created answer:', answer);\n      await peerConnectionRef.current.setLocalDescription(answer);\n\n      const roomWithAnswer = {\n        answer: {\n          type: answer.type,\n          sdp: answer.sdp,\n        },\n        isAccepting: true,\n      };\n      await connectionRef.update(roomWithAnswer);\n\n      // Listening for remote ICE candidates\n      const calllerUnsubscriber = connectionRef.collection(CALLER).onSnapshot((snapshot) => {\n        snapshot.docChanges().forEach(async (change) => {\n          if (change.type === 'added') {\n            let data = change.doc.data();\n            console.log(`Got new remote ICE candidate: ${JSON.stringify(data)}`);\n            console.log(peerConnectionRef.current);\n            await peerConnectionRef.current!.addIceCandidate(new RTCIceCandidate(data));\n          }\n        });\n      });\n      callerUnsubscriberRef.current = calllerUnsubscriber;\n    }\n  };\n\n  return {\n    receiveChannelRef,\n    joinTransferChannel,\n  };\n};\n\nexport default useJoinTransferChannel;\n","import {useRef, useCallback} from 'react';\nimport firebase from 'src/services/firebase';\nimport {IPeerField} from 'src/types';\nimport {CALLEE, CALLER, CONNECTIONS, MAXIMUM_BUFFER_BYTE, MIN_CHUNK_SIZE, ROOT_COLLECTION} from 'src/constants';\nimport pcConfig from 'src/services/rtcPeerConnectionConfig';\nimport {toast} from 'react-toastify';\nimport {WaitResponsePopperReducerAction} from 'src/components/Poppers/WaitResponsePopper';\nimport {ProgressPopperReducerAction} from './Poppers/ProgressPopper';\n\ninterface Props {\n  localID: string;\n  publicID: string;\n  firestoreDbRef: firebase.firestore.Firestore;\n  connectionIdRef: React.MutableRefObject<string | null>;\n  peerConnectionRef: React.MutableRefObject<RTCPeerConnection | null>;\n  calleeUnsubscriberRef: React.MutableRefObject<(() => void) | undefined>;\n  descriptionUnsubscriberRef: React.MutableRefObject<(() => void) | undefined>;\n  sentFileReaderRef: React.MutableRefObject<FileReader | null>;\n  totalFileSizeRef: React.MutableRefObject<number>;\n  acceptedFileListRef: React.MutableRefObject<File[]>;\n  dispatchWaitResponsePopperData: (value: WaitResponsePopperReducerAction) => void;\n  dispatchProgressPopperData: (value: ProgressPopperReducerAction) => void;\n}\n\nconst useCreateTransferChannel = ({\n  localID,\n  publicID,\n  firestoreDbRef,\n  connectionIdRef,\n  peerConnectionRef,\n  calleeUnsubscriberRef,\n  descriptionUnsubscriberRef,\n  totalFileSizeRef,\n  sentFileReaderRef,\n  acceptedFileListRef,\n  dispatchWaitResponsePopperData,\n  dispatchProgressPopperData,\n}: Props) => {\n  const sendChannelRef = useRef<RTCDataChannel | null>(null);\n\n  const sendFileData = useCallback(async () => {\n    if (!acceptedFileListRef.current || acceptedFileListRef.current.length === 0) return;\n    console.log(`Sending files:`, acceptedFileListRef.current);\n\n    const files = [...acceptedFileListRef.current];\n\n    const maxMessageSize = peerConnectionRef.current?.sctp?.maxMessageSize;\n    console.log('maximum message size is: ', maxMessageSize);\n\n    const chunkSize = maxMessageSize || MIN_CHUNK_SIZE;\n    let singularOffset = 0; // total byte sent for single file\n    let targetFileIndex = 0;\n    let totalOffset = 0; // sum byte sent for all files\n\n    function onTransferSuccess() {\n      toast.success('File has been transferred');\n      singularOffset = 0;\n      targetFileIndex = 0;\n      totalOffset = 0;\n      dispatchProgressPopperData({type: 'clear'});\n      acceptedFileListRef.current = [];\n    }\n\n    sentFileReaderRef.current = new FileReader();\n    sentFileReaderRef.current.addEventListener('error', (error) => {\n      console.error('Error reading file:', error);\n      toast.error(`Failed to read file: ${files[targetFileIndex].name}`);\n    });\n    sentFileReaderRef.current.addEventListener('abort', (event) => {\n      console.log('File reading aborted:', event);\n      toast.warn(`Abort file read: ${files[targetFileIndex].name}`);\n    });\n    sentFileReaderRef.current.addEventListener('load', (event) => {\n      let result = event!.target!.result as ArrayBuffer;\n\n      (sendChannelRef.current as RTCDataChannel).send(result);\n\n      totalOffset += result.byteLength;\n      singularOffset += result.byteLength;\n\n      let sentProgress = Math.round((totalOffset / totalFileSizeRef.current) * 100);\n\n      dispatchProgressPopperData({\n        type: 'set_sent_progress',\n        payload: {progress: sentProgress},\n      });\n\n      if (totalOffset < totalFileSizeRef.current) {\n        (function checkBufferAmount() {\n          // bug: maxMessageSize unstable for chromium buffer\n          if ((sendChannelRef.current as RTCDataChannel).bufferedAmount + result.byteLength < MAXIMUM_BUFFER_BYTE) {\n            readSlice(singularOffset);\n          } else {\n            // wait until buffer is not full\n            setTimeout(checkBufferAmount, 500);\n          }\n        })();\n      } else {\n        console.log('transfer done');\n        onTransferSuccess();\n      }\n    });\n\n    const readSlice = (o: number) => {\n      // console.log(`read ${files[targetFileIndex].name} slice `, o);\n      // console.log('total fileChunks', totalOffset);\n\n      let slice: Blob;\n\n      // If still transfer current index file\n      if (o < files[targetFileIndex].size) {\n        let nextChunk: number = o + chunkSize;\n        // when total chunk + next slice is exceeding the file, set next Chunk at the file size for complete current index's file\n        if (nextChunk > files[targetFileIndex].size) nextChunk = files[targetFileIndex].size;\n        // continue next slice chunk\n        slice = files[targetFileIndex].slice(singularOffset, nextChunk);\n      } else {\n        // Else reset total byte sent for single file, move on to next file\n        targetFileIndex += 1;\n        singularOffset = 0;\n        if (!files[targetFileIndex]) {\n          // done\n          onTransferSuccess();\n          return;\n        }\n        // slice next file\n        slice = files[targetFileIndex].slice(singularOffset, chunkSize);\n      }\n      // load target slice\n      sentFileReaderRef.current!.readAsArrayBuffer(slice);\n    };\n\n    // begin slice files for transfer\n    readSlice(0);\n  }, [\n    sendChannelRef,\n    totalFileSizeRef,\n    sentFileReaderRef,\n    acceptedFileListRef,\n    peerConnectionRef,\n    dispatchProgressPopperData,\n  ]);\n\n  const createSendDataChannel = useCallback(() => {\n    sendChannelRef.current = peerConnectionRef.current!.createDataChannel('sendDataChannel');\n    console.log('Created send data channel: ', sendChannelRef.current);\n\n    sendChannelRef.current.binaryType = 'arraybuffer';\n    sendChannelRef.current.onopen = onSendChannelStateChange;\n    sendChannelRef.current.onclose = onSendChannelStateChange;\n    sendChannelRef.current.onerror = onError;\n\n    function onSendChannelStateChange() {\n      // console.log('send channel: ',sendChannelRef.current);\n      if (sendChannelRef.current) {\n        const {readyState} = sendChannelRef.current;\n        console.log(`Send channel state is: ${readyState}`);\n        if (readyState === 'open') {\n          sendFileData();\n          dispatchWaitResponsePopperData({type: 'clear'});\n        }\n        if (readyState === 'closed') {\n          sendChannelRef.current = null;\n        }\n      }\n    }\n    function onError(errorEvent: RTCErrorEvent) {\n      if (sendChannelRef.current) {\n        console.error('Error in sendChannel:', errorEvent);\n        return;\n      }\n      console.log('Error in sendChannel which is already closed:', errorEvent);\n    }\n  }, [peerConnectionRef, sendChannelRef, sendFileData, dispatchWaitResponsePopperData]);\n\n  const tryCreatePeerConnection = async (peer: IPeerField) => {\n    const roomRef = firestoreDbRef.collection(ROOT_COLLECTION).doc(publicID);\n    const connectionsRef = roomRef.collection(CONNECTIONS);\n    const targetConnectionRef = connectionsRef.doc();\n\n    const p2pData = {\n      p2p: {\n        offer: localID,\n        answer: peer.id,\n      },\n    };\n\n    const callerCandidatesCollection = targetConnectionRef.collection(CALLER);\n\n    peerConnectionRef.current = new RTCPeerConnection(pcConfig);\n    // console.log('created pc', peerConnectionRef.current);\n    connectionIdRef.current = targetConnectionRef.id;\n\n    // set up send data channel and listeners\n    createSendDataChannel();\n\n    peerConnectionRef.current.addEventListener('icecandidate', (event) => {\n      if (!event.candidate) {\n        console.log('Got final candidate!');\n        return;\n      }\n      // console.log('Got candidate: ', event.candidate);\n      callerCandidatesCollection.add(event.candidate.toJSON());\n    });\n\n    // Creating a room with offer sdp and update remote\n    const offer = await peerConnectionRef.current.createOffer();\n    await peerConnectionRef.current.setLocalDescription(offer);\n    console.log('Created offer:', offer);\n\n    const roomWithOffer = {\n      offer: {\n        type: offer.type,\n        sdp: offer.sdp,\n      },\n      isAccepting: false,\n    };\n\n    await targetConnectionRef.set({\n      ...roomWithOffer,\n      ...p2pData,\n    });\n\n    // Listening for remote session description\n    const descriptionUnsubscriber = targetConnectionRef.onSnapshot(async (snapshot) => {\n      const data = snapshot.data();\n      if (!data || !data.answer) return;\n      if (peerConnectionRef.current && !peerConnectionRef.current!.currentRemoteDescription) {\n        // console.log('Got remote description: ', data.answer);\n        const rtcSessionDescription = new RTCSessionDescription(data.answer);\n        await peerConnectionRef.current!.setRemoteDescription(rtcSessionDescription);\n\n        dispatchWaitResponsePopperData({type: 'set_desc'});\n      }\n    });\n    descriptionUnsubscriberRef.current = descriptionUnsubscriber;\n\n    // Listen for remote ICE candidates\n    const calleeUnsubscriber = targetConnectionRef.collection(CALLEE).onSnapshot((snapshot) => {\n      snapshot.docChanges().forEach(async (change) => {\n        if (change.type === 'added') {\n          let data = change.doc.data();\n          // console.log(`Got new remote ICE candidate: ${JSON.stringify(data)}`);\n          await peerConnectionRef.current!.addIceCandidate(new RTCIceCandidate(data));\n        }\n      });\n    });\n    calleeUnsubscriberRef.current = calleeUnsubscriber;\n\n    dispatchWaitResponsePopperData({type: 'set_open_without_desc'});\n  };\n\n  return {\n    sendChannelRef,\n    tryCreatePeerConnection,\n  };\n};\n\nexport default useCreateTransferChannel;\n","import React, {useState, useEffect, useMemo, useRef, useCallback, useReducer} from 'react';\nimport firebase from 'src/services/firebase';\nimport {IFileMeta, IFirebaseConnectionRoomData, IPeerField} from 'src/types';\nimport {toast} from 'react-toastify';\nimport PeerFileDropZone from 'src/components/DropZone/PeerFileDropZone';\nimport ProgressPopper, {initialProgressPopperData, progressPopperReducer} from 'src/components/Poppers/ProgressPopper';\nimport NotifyOfferPopper, {\n  notifyOfferPopperReducer,\n  initialNotifyOfferPopperData,\n} from 'src/components/Poppers/NotifyOfferPopper';\nimport WaitResponsePopper, {\n  initialWaitResponsePopperData,\n  waitResponsePopperReducer,\n} from 'src/components/Poppers/WaitResponsePopper';\nimport {\n  CALLEE,\n  CALLER,\n  CONNECTIONS,\n  FILE_METAS,\n  WAIT_REMOTE_DESC,\n  ROOT_COLLECTION,\n  APP_AUTO_ACCEPT,\n  APP_AUTO_DOWNLOAD,\n} from 'src/constants';\nimport useJoinTransferChannel from 'src/components/useJoinTransferChannel';\nimport useCreateTransferChannel from 'src/components/useCreateTransferChannel';\n\ninterface Props {\n  targetPeer: IPeerField;\n  localID: string;\n  publicID: string;\n  sendAllFiles: File[];\n  clearSentAllFiles: () => void;\n  firestoreDbRef: firebase.firestore.Firestore;\n}\n\nconst PeerConnectionHolder: React.FC<Props> = ({\n  targetPeer,\n  localID,\n  publicID,\n  firestoreDbRef,\n  sendAllFiles,\n  clearSentAllFiles,\n}) => {\n  const isInit = useRef(true);\n  const peerConnectionRef = useRef<RTCPeerConnection | null>(null);\n  const connectionIdRef = useRef<string | null>(null);\n  const sentFileReaderRef = useRef<FileReader | null>(null);\n  const totalFileSizeRef = useRef<number>(0);\n  const acceptedFileListRef = useRef<File[]>([]);\n  const callerUnsubscriberRef = useRef<() => void>();\n  const calleeUnsubscriberRef = useRef<() => void>();\n  const descriptionUnsubscriberRef = useRef<() => void>();\n\n  const [anchorElement, setAnchorElement] = useState(null);\n\n  const [waitResponsePopperData, dispatchWaitResponsePopperData] = useReducer(\n    waitResponsePopperReducer,\n    initialWaitResponsePopperData,\n  );\n  const [notifyOfferPopperData, dispatchNotifyPopperOfferData] = useReducer(\n    notifyOfferPopperReducer,\n    initialNotifyOfferPopperData,\n  );\n  const [progressPopperData, dispatchProgressPopperData] = useReducer(progressPopperReducer, initialProgressPopperData);\n\n  const shouldDisableActionBtn = useMemo(\n    () => waitResponsePopperData.isOpen || notifyOfferPopperData.isOpen || progressPopperData.isOpen,\n    [waitResponsePopperData.isOpen, notifyOfferPopperData.isOpen, progressPopperData.isOpen],\n  );\n\n  useEffect(() => {\n    const roomRef = firestoreDbRef.collection(ROOT_COLLECTION).doc(publicID);\n    const connectionRef = roomRef.collection(CONNECTIONS);\n\n    const unsubscribe = connectionRef.onSnapshot(async (snapshot) => {\n      snapshot.docChanges().forEach(async (change) => {\n        let data = change.doc.data() as IFirebaseConnectionRoomData;\n        if (change.type === 'modified') {\n          const {isAccepting} = data;\n          if (\n            data.p2p &&\n            data.fileMetas &&\n            !data.answer &&\n            data.p2p.answer === localID &&\n            data.p2p.offer === targetPeer.id\n          ) {\n            if (!isAccepting) {\n              promptsIncomingFileTransferPopper(data.fileMetas, change.doc.id);\n            }\n          }\n        }\n        if (change.type === 'removed') {\n          let connectionId = change.doc.id;\n          console.log('remove connection: ');\n          console.log(connectionId, connectionIdRef.current);\n          if (\n            connectionId === connectionIdRef.current &&\n            data.p2p &&\n            (data.p2p.answer === localID || data.p2p.offer === localID)\n          ) {\n            closeDataChannels(true);\n          }\n        }\n      });\n    });\n\n    return () => {\n      // close connection and delete the document on peer presence drop\n      unsubscribe();\n      closeDataChannels(false);\n      destroyExistingPC();\n      if (sessionStorage.getItem(WAIT_REMOTE_DESC)) {\n        toast.warn('Peer connection dropped');\n        sessionStorage.removeItem(WAIT_REMOTE_DESC);\n      }\n    };\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, []);\n\n  useEffect(() => {\n    if (isInit.current) {\n      isInit.current = false;\n    } else {\n      handleFileInputChange([...sendAllFiles]);\n      clearSentAllFiles();\n    }\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [isInit, sendAllFiles]);\n\n  const clearFirebaseConnection = useCallback(async () => {\n    if (callerUnsubscriberRef.current) callerUnsubscriberRef.current();\n    if (calleeUnsubscriberRef.current) calleeUnsubscriberRef.current();\n    if (descriptionUnsubscriberRef.current) descriptionUnsubscriberRef.current();\n\n    const connectionId = connectionIdRef.current;\n    if (connectionId) {\n      const roomRef = firestoreDbRef.collection(ROOT_COLLECTION).doc(publicID);\n      const connectionRef = roomRef.collection(CONNECTIONS).doc(connectionId);\n      const calleeCandidates = await connectionRef.collection(CALLEE).get();\n      calleeCandidates.forEach(async (candidate) => {\n        await candidate.ref.delete();\n      });\n      const callerCandidates = await connectionRef.collection(CALLER).get();\n      callerCandidates.forEach(async (candidate) => {\n        await candidate.ref.delete();\n      });\n      await connectionRef.delete();\n      connectionIdRef.current = null;\n    }\n  }, [\n    firestoreDbRef,\n    connectionIdRef,\n    callerUnsubscriberRef,\n    calleeUnsubscriberRef,\n    descriptionUnsubscriberRef,\n    publicID,\n  ]);\n\n  const handleDownloadFile = (receivedBlob: Blob, name: string) => {\n    const appAutoDownload = window.localStorage.getItem(APP_AUTO_DOWNLOAD);\n    const shouldAutoDownload = appAutoDownload === 'true';\n\n    if (shouldAutoDownload) {\n      let downloadAnchor = document.createElement('a');\n      downloadAnchor.href = URL.createObjectURL(receivedBlob);\n      downloadAnchor.download = name;\n      document.body.appendChild(downloadAnchor);\n      downloadAnchor.click();\n      window.URL.revokeObjectURL(downloadAnchor.href);\n      document.body.removeChild(downloadAnchor);\n    } else {\n      dispatchProgressPopperData({\n        type: 'set_downloadableFiles',\n        payload: {\n          downloadableFile: {\n            fileName: name,\n            fileBlobUrl: URL.createObjectURL(receivedBlob),\n          },\n        },\n      });\n    }\n  };\n\n  const {receiveChannelRef, joinTransferChannel} = useJoinTransferChannel({\n    publicID,\n    firestoreDbRef,\n    connectionIdRef,\n    peerConnectionRef,\n    callerUnsubscriberRef,\n    dispatchProgressPopperData,\n    dispatchWaitResponsePopperData,\n    handleDownloadFile,\n    clearSignalService: clearFirebaseConnection,\n  });\n\n  const {sendChannelRef, tryCreatePeerConnection} = useCreateTransferChannel({\n    localID,\n    publicID,\n    firestoreDbRef,\n    connectionIdRef,\n    peerConnectionRef,\n    calleeUnsubscriberRef,\n    descriptionUnsubscriberRef,\n    totalFileSizeRef,\n    sentFileReaderRef,\n    acceptedFileListRef,\n    dispatchProgressPopperData,\n    dispatchWaitResponsePopperData,\n  });\n\n  const closeDataChannels = useCallback(\n    (shouldWarn: boolean) => {\n      // console.log('Closing data channels: ');\n      dispatchWaitResponsePopperData({type: 'clear'});\n\n      if (sendChannelRef.current) {\n        sendChannelRef.current.close();\n        if (shouldWarn) toast.warn('File transfer is closed');\n        console.log(`Closed send data channel with label: ${sendChannelRef.current.label}`);\n      }\n      if (receiveChannelRef.current) {\n        receiveChannelRef.current.close();\n        console.log(`Closed receive data channel with label: ${receiveChannelRef.current.label}`);\n      }\n      clearFirebaseConnection();\n    },\n    [sendChannelRef, receiveChannelRef, clearFirebaseConnection],\n  );\n\n  const destroyExistingPC = useCallback(() => {\n    if (peerConnectionRef.current) {\n      console.log('closing peers connection');\n      peerConnectionRef.current.close();\n      peerConnectionRef.current = null;\n      // window.location.reload();\n    }\n  }, [peerConnectionRef]);\n\n  async function handleFileInputChange(files: File[]) {\n    if (files.length > 0) {\n      acceptedFileListRef.current = files;\n\n      await tryCreatePeerConnection(targetPeer);\n      const connectionId = connectionIdRef.current as string;\n\n      const roomRef = firestoreDbRef.collection(ROOT_COLLECTION).doc(publicID);\n      const connectionsRef = roomRef.collection(CONNECTIONS);\n      const targetConnectionRef = connectionsRef.doc(connectionId);\n\n      let metas: IFileMeta[] = [];\n\n      files.forEach((file) => {\n        metas.push({\n          name: file.name,\n          size: file.size,\n          type: file.type,\n        });\n        totalFileSizeRef.current += file.size;\n      });\n\n      let fileMetas = {\n        [FILE_METAS]: metas,\n      };\n\n      await targetConnectionRef.update(fileMetas);\n    }\n  }\n\n  const onAcceptFileTransfer = () => {\n    joinTransferChannel(connectionIdRef.current as string);\n    if (!waitResponsePopperData.isOpen) {\n      dispatchWaitResponsePopperData({type: 'set_open_with_desc'});\n    }\n  };\n\n  const onCancelFileTransfer = () => {\n    if (sentFileReaderRef.current && sentFileReaderRef.current.readyState === 1) {\n      console.log('Abort file read...');\n      sentFileReaderRef.current.abort();\n    }\n    if (notifyOfferPopperData.isOpen) {\n      dispatchNotifyPopperOfferData({type: 'clear'});\n    }\n    closeDataChannels(false);\n  };\n\n  const promptsIncomingFileTransferPopper = async (fileMetas: IFileMeta[], connectionId: string) => {\n    console.log('incoming file metas:', fileMetas);\n    console.log('got from:', targetPeer);\n\n    connectionIdRef.current = connectionId;\n\n    const appAutoAccept = window.localStorage.getItem(APP_AUTO_ACCEPT);\n    const shouldAutoAccept = appAutoAccept === 'true';\n\n    if (shouldAutoAccept) {\n      onAcceptFileTransfer();\n    } else {\n      dispatchNotifyPopperOfferData({type: 'set_file_metas', payload: {fileMetas}});\n    }\n  };\n\n  return (\n    <div className=\"peerHolder\">\n      <PeerFileDropZone\n        shouldDisableActionBtn={shouldDisableActionBtn}\n        handleFileInputChange={handleFileInputChange}\n        targetPeer={targetPeer}\n        setAnchorElement={setAnchorElement}\n      />\n\n      {waitResponsePopperData.isOpen && (\n        <WaitResponsePopper {...waitResponsePopperData} targetPeer={targetPeer} anchorElement={anchorElement} />\n      )}\n\n      {progressPopperData.isOpen && (\n        <ProgressPopper\n          {...progressPopperData}\n          onCancelFileTransfer={onCancelFileTransfer}\n          targetPeer={targetPeer}\n          setClose={() => dispatchProgressPopperData({type: 'clear'})}\n          anchorElement={anchorElement}\n        />\n      )}\n\n      {notifyOfferPopperData.isOpen && (\n        <NotifyOfferPopper\n          {...notifyOfferPopperData}\n          onAcceptFileTransfer={onAcceptFileTransfer}\n          onCancelFileTransfer={onCancelFileTransfer}\n          targetPeer={targetPeer}\n          setClose={() => dispatchNotifyPopperOfferData({type: 'clear'})}\n          anchorElement={anchorElement}\n        />\n      )}\n    </div>\n  );\n};\n\nexport default PeerConnectionHolder;\n","import React, {memo, useState, useEffect} from 'react';\nimport firebase from 'src/services/firebase';\nimport styled from 'styled-components';\nimport breakpoints from 'src/styles/breakpoints';\nimport StyledPeerPosition from 'src/styles/styled-components/StyledPeerPosition';\nimport SelfFileDropZone from 'src/components/DropZone/SelfFileDropZone';\nimport PeerConnectionHolder from 'src/components/PeerConnectionHolder';\nimport {IPeerField} from 'src/types';\nimport {toast} from 'react-toastify';\nimport {MAXIMUM_PEER_NUMBER} from 'src/constants';\nimport Grow from '@material-ui/core/Grow';\n\nconst StyledP = styled.p<{$shouldHide: boolean}>`\n  color: ${(props) => props.theme.primary.contrastText};\n  margin-top: ${(props) => (props.$shouldHide ? '0px' : '25%')};\n  height: ${(props) => (props.$shouldHide ? '0px' : 'auto')};\n  white-space: pre-wrap;\n  word-wrap: break-word;\n  max-width: 80%;\n  span {\n    font-size: 12px;\n  }\n`;\n\nconst PeersHolder = styled(StyledPeerPosition)`\n  position: relative;\n  height: 100%;\n  width: 100%;\n  z-index: 1;\n  overflow-y: auto;\n  padding-top: 1em;\n  padding-bottom: 100px;\n  @media only screen and (${breakpoints.sm}) {\n    padding-bottom: 0;\n    margin-bottom: 120px;\n    display: flex;\n    flex-direction: column;\n    justify-content: space-around;\n  }\n`;\n\ninterface Props {\n  selfIdentity: IPeerField | null | undefined;\n  publicID: string;\n  localID: string;\n}\n\nconst PeersListener: React.FC<Props> = ({selfIdentity, publicID, localID}) => {\n  const [otherPeers, setOtherPeers] = useState<IPeerField[]>([]);\n  const [sendAllFiles, setSendAllFiles] = useState<File[]>([]);\n\n  const dbRef = React.useRef(firebase.firestore());\n\n  useEffect(() => {\n    const db = firebase.database();\n    const peersRef = db.ref(`${publicID}`);\n    peersRef.on('value', async (snapshot) => {\n      const allPeers: IPeerField[] = snapshot.val();\n      let peerHolder: IPeerField[] = [];\n      for (let id in allPeers) {\n        if (id !== localID) peerHolder.push(allPeers[id]);\n      }\n      if (peerHolder.length > MAXIMUM_PEER_NUMBER) {\n        toast.dismiss();\n        toast.warn(`The maximum concurrent peers is set to ${MAXIMUM_PEER_NUMBER}`);\n      } else {\n        setOtherPeers(peerHolder);\n      }\n    });\n\n    return () => {\n      peersRef.off();\n    };\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [publicID]);\n\n  function handleFileInputChange(files: File[]) {\n    if (otherPeers.length === 0) {\n      toast.warn('There is no other peers in this room');\n      clearSentAllFiles();\n    } else {\n      setSendAllFiles(files);\n    }\n  }\n\n  function clearSentAllFiles() {\n    if (sendAllFiles.length > 0) setSendAllFiles([]);\n  }\n\n  let noPeer = otherPeers.length === 0;\n\n  return (\n    <>\n      <Grow in={noPeer}>\n        <StyledP $shouldHide={!noPeer}>\n          Open the same link to start transfer files\n          <br />\n          <span>swipe right or click drawer icons to see or toggle app settings</span>\n        </StyledP>\n      </Grow>\n      <Grow in={!noPeer}>\n        <PeersHolder>\n          {otherPeers.map((peer) => (\n            <PeerConnectionHolder\n              clearSentAllFiles={clearSentAllFiles}\n              sendAllFiles={sendAllFiles}\n              firestoreDbRef={dbRef.current}\n              key={peer.id}\n              targetPeer={peer}\n              publicID={publicID}\n              localID={localID}\n            />\n          ))}\n        </PeersHolder>\n      </Grow>\n      {selfIdentity && (\n        <SelfFileDropZone\n          shouldDisableActionBtn={sendAllFiles.length > 0}\n          handleFileInputChange={handleFileInputChange}\n          publicID={publicID}\n          localID={localID}\n          selfIdentity={selfIdentity}\n        />\n      )}\n    </>\n  );\n};\n\nexport default memo(PeersListener);\n","export const brightnessTheme = {\n  light: {\n    primary: {\n      main: '#f1f0ea',\n      light: '#f3f3ee',\n      dark: '#d7d7d3',\n      contrastText: '#025855',\n    },\n    secondary: {\n      main: '#cd5521',\n      dark: '#8f3b17',\n      light: '#d7774d',\n      contrastText: '#fff',\n    },\n  },\n  dark: {\n    primary: {\n      main: '#303846',\n      light: '#595f6b',\n      dark: '#212731',\n      contrastText: '#fff',\n    },\n    secondary: {\n      main: '#1565C0',\n      dark: '#0e4686',\n      light: '#4383cc',\n      contrastText: '#fff',\n    },\n  },\n};\n\nconst theme = {\n  drawerMinWidth: '55px',\n  ...brightnessTheme.dark, // default dark\n};\n\nexport default theme;\n","import {createStyles, makeStyles, Theme} from '@material-ui/core/styles';\nimport appTheme from 'src/styles/theme';\n\nconst useDrawerStyles = makeStyles((theme: Theme) =>\n  createStyles({\n    hide: {\n      display: 'none',\n    },\n    drawer: {\n      flexShrink: 0,\n      whiteSpace: 'nowrap',\n    },\n    drawerOpen: {\n      width: 290,\n      transition: theme.transitions.create('width', {\n        easing: theme.transitions.easing.sharp,\n        duration: theme.transitions.duration.enteringScreen,\n      }),\n    },\n    drawerClose: {\n      width: appTheme.drawerMinWidth,\n      transition: theme.transitions.create('width', {\n        easing: theme.transitions.easing.sharp,\n        duration: theme.transitions.duration.leavingScreen,\n      }),\n      overflow: 'hidden',\n    },\n    titleText: {\n      fontSize: 22,\n      position: 'absolute',\n      left: 16,\n    },\n    titleBar: {\n      display: 'flex',\n      alignItems: 'center',\n      height: 60,\n      justifyContent: 'flex-end',\n    },\n  }),\n);\n\nexport default useDrawerStyles;\n","import React from 'react';\nimport styled from 'styled-components';\nimport {toast} from 'react-toastify';\nimport {IdentityContext, IIdentityContextVariable} from 'src/providers/IdentityProvider';\n\nimport List from '@material-ui/core/List';\nimport Divider from '@material-ui/core/Divider';\nimport ListItem from '@material-ui/core/ListItem';\nimport ListItemIcon from '@material-ui/core/ListItemIcon';\nimport ListItemText from '@material-ui/core/ListItemText';\nimport Switch from '@material-ui/core/Switch';\nimport Tooltip from '@material-ui/core/Tooltip';\nimport InputBase from '@material-ui/core/InputBase';\n\nimport AccountTreeIcon from '@material-ui/icons/AccountTree';\nimport GitHubIcon from '@material-ui/icons/GitHub';\nimport HelpIcon from '@material-ui/icons/Help';\nimport CloudIcon from '@material-ui/icons/CloudDownloadSharp';\nimport CloudOffIcon from '@material-ui/icons/CloudOff';\nimport ChatIcon from '@material-ui/icons/Chat';\nimport ChatOffIcon from '@material-ui/icons/SpeakerNotesOff';\nimport LightBrightnessIcon from '@material-ui/icons/Brightness7';\nimport DarkBrightnessIcon from '@material-ui/icons/Brightness4';\nimport {IAppSettingContextVariable} from 'src/providers/AppSettingProvider';\nimport FileCopyOutlinedIcon from '@material-ui/icons/FileCopyOutlined';\nimport {ELE_PUBLIC_ID, ELE_PUBLIC_ID_WRAPPER} from 'src/constants';\n\nconst StyledListItemIcon = styled(ListItemIcon)`\n  margin-right: -16px;\n  color: ${(props) => props.theme.primary.contrastText} !important;\n`;\n\nconst StyledListItem = styled(ListItem)<{$isOpen: boolean}>`\n  margin-top: 4px;\n  justify-content: space-between !important;\n  line-height: 1.5em;\n  cursor: pointer;\n  padding: 0.5em 1em;\n  font-size: 14px;\n  text-align: left;\n  padding-bottom: 1em;\n  visibility: ${(props) => (props.$isOpen ? 'visible' : 'hidden')};\n  * {\n    pointer-events: none;\n  }\n  span {\n    font-weight: 300;\n  }\n  input {\n    min-width: 200px;\n    pointer-events: auto;\n    color: ${(props) => props.theme.primary.contrastText};\n  }\n`;\n\nconst StyledList = styled(List)`\n  margin-top: auto !important;\n`;\n\ninterface Props extends IAppSettingContextVariable {\n  drawerOpen: boolean;\n  handleJoinRoomModalOpen: () => void;\n  handleAboutModalOpen: () => void;\n}\n\ninterface IDrawerOptionList extends Props {\n  publicID: string;\n}\n\nconst DrawerOptionList: React.FC<IDrawerOptionList> = ({\n  publicID,\n  drawerOpen,\n  shouldAutoAccept,\n  shouldAutoDownload,\n  appTheme,\n  toggleAutoAccept,\n  toggleAutoDownload,\n  toggleLightDarkTheme,\n  handleJoinRoomModalOpen,\n  handleAboutModalOpen,\n}) => {\n  const handleCopyPublicID = async (e: React.MouseEvent<HTMLDivElement, MouseEvent>) => {\n    e.stopPropagation();\n    try {\n      await navigator.clipboard.writeText(publicID);\n      toast.dismiss();\n      toast.info('Room Id copied', {\n        autoClose: 3000,\n      });\n    } catch {\n      (document.getElementById(ELE_PUBLIC_ID) as HTMLInputElement).select();\n    }\n  };\n\n  const handleSourceRedirect = () => window.open('https://github.com/haooowu/PeerTransfer');\n\n  return (\n    <>\n      <List>\n        <Tooltip title={'Auto Accept'} placement=\"right\">\n          <ListItem button onClick={toggleAutoAccept}>\n            <StyledListItemIcon>{shouldAutoAccept ? <ChatIcon /> : <ChatOffIcon />}</StyledListItemIcon>\n            <ListItemText primary={'Auto Accept Request'} />\n            <Switch checked={shouldAutoAccept} inputProps={{'aria-label': 'secondary checkbox'}} />\n          </ListItem>\n        </Tooltip>\n\n        <Tooltip title={'Auto Download'} placement=\"right\">\n          <ListItem button onClick={toggleAutoDownload}>\n            <StyledListItemIcon>{shouldAutoDownload ? <CloudIcon /> : <CloudOffIcon />}</StyledListItemIcon>\n            <ListItemText primary={'Auto Download File'} />\n            <Switch checked={shouldAutoDownload} inputProps={{'aria-label': 'secondary checkbox'}} />\n          </ListItem>\n        </Tooltip>\n      </List>\n\n      <Divider />\n\n      <List>\n        <Tooltip title=\"Brightness Theme\" placement=\"right\">\n          <ListItem button onClick={toggleLightDarkTheme}>\n            <StyledListItemIcon>\n              {appTheme === 'light' ? <LightBrightnessIcon /> : <DarkBrightnessIcon />}\n            </StyledListItemIcon>\n            <ListItemText primary={'Light / Dark Theme'} />\n          </ListItem>\n        </Tooltip>\n        <Tooltip title=\"Join Another Room\" placement=\"right\">\n          <ListItem button onClick={handleJoinRoomModalOpen}>\n            <StyledListItemIcon>\n              <AccountTreeIcon />\n            </StyledListItemIcon>\n            <ListItemText primary={'Join a room'} />\n          </ListItem>\n        </Tooltip>\n      </List>\n\n      <Divider />\n\n      <List>\n        <StyledListItem button id={ELE_PUBLIC_ID_WRAPPER} $isOpen={drawerOpen} onClick={(e) => handleCopyPublicID(e)}>\n          <div>\n            <span>Room ID:</span>\n            <br />\n            <InputBase id={ELE_PUBLIC_ID} value={publicID} inputProps={{'aria-label': 'naked'}} />\n          </div>\n          <StyledListItemIcon>\n            <FileCopyOutlinedIcon />\n          </StyledListItemIcon>\n        </StyledListItem>\n      </List>\n\n      <StyledList>\n        <Tooltip title=\"About\" placement=\"right\">\n          <ListItem button onClick={handleAboutModalOpen}>\n            <StyledListItemIcon>\n              <HelpIcon />\n            </StyledListItemIcon>\n            <ListItemText primary={'About'} />\n          </ListItem>\n        </Tooltip>\n        <Tooltip title=\"Source Code\" placement=\"right\">\n          <ListItem button onClick={handleSourceRedirect}>\n            <StyledListItemIcon>\n              <GitHubIcon />\n            </StyledListItemIcon>\n            <ListItemText primary={'Source'} />\n          </ListItem>\n        </Tooltip>\n      </StyledList>\n    </>\n  );\n};\n\nconst ConsumedDrawerOptionList = (props: Props) => (\n  <IdentityContext.Consumer>\n    {({publicID}: IIdentityContextVariable) => <DrawerOptionList publicID={publicID} {...props} />}\n  </IdentityContext.Consumer>\n);\n\nexport default ConsumedDrawerOptionList;\n","import React from 'react';\nimport styled from 'styled-components';\nimport {toast} from 'react-toastify';\nimport {PUBLIC_ID} from 'src/constants';\n\nimport Button from '@material-ui/core/Button';\nimport TextField from '@material-ui/core/TextField';\nimport Dialog from '@material-ui/core/Dialog';\nimport DialogActions from '@material-ui/core/DialogActions';\nimport DialogContent from '@material-ui/core/DialogContent';\nimport DialogContentText from '@material-ui/core/DialogContentText';\nimport DialogTitle from '@material-ui/core/DialogTitle';\n\nconst StyledDialogActions = styled(DialogActions)`\n  padding: 8px 16px !important;\n`;\n\ninterface Props {\n  open: boolean;\n  handleClose: () => void;\n}\n\nconst allowedCharRegex = new RegExp(/^[a-zA-Z0-9+/=]+$/);\n\nconst JoinRoomModal: React.FC<Props> = ({open, handleClose}) => {\n  const [input, setInput] = React.useState('');\n\n  const handleConfirm = () => {\n    if (!input.trim() || input.length < 1 || input.length > 30) {\n      toast.error('Invalid room id format');\n      return;\n    }\n    sessionStorage.setItem(PUBLIC_ID, input);\n    window.location.reload();\n  };\n\n  const handleChange = (event: React.ChangeEvent<HTMLInputElement>) => {\n    let targetInput = event.target.value;\n    if (allowedCharRegex.test(targetInput) || targetInput === '') setInput(targetInput);\n  };\n\n  return (\n    <Dialog open={open} onClose={handleClose}>\n      <DialogTitle>Join or Create Room</DialogTitle>\n      <DialogContent>\n        <DialogContentText>You can find current room ID by expand the side drawer</DialogContentText>\n        <TextField\n          onChange={handleChange}\n          value={input}\n          autoFocus\n          color=\"secondary\"\n          margin=\"dense\"\n          label=\"Room ID\"\n          type=\"text\"\n          fullWidth\n        />\n      </DialogContent>\n      <StyledDialogActions>\n        <Button onClick={handleClose} color=\"secondary\">\n          Cancel\n        </Button>\n        <Button onClick={handleConfirm} color=\"secondary\">\n          Confirm\n        </Button>\n      </StyledDialogActions>\n    </Dialog>\n  );\n};\n\nexport default JoinRoomModal;\n","import React from 'react';\nimport styled from 'styled-components';\nimport Link from '@material-ui/core/Link';\nimport Dialog from '@material-ui/core/Dialog';\nimport DialogContent from '@material-ui/core/DialogContent';\nimport DialogContentText from '@material-ui/core/DialogContentText';\nimport {MAXIMUM_FILE_BYTE, MAXIMUM_FILE_NUMBER, MAXIMUM_PEER_NUMBER} from 'src/constants';\n\nimport readableBytes from 'src/utils/readableBytes';\n\nconst CustomLabel = styled.div`\n  font-weight: bold;\n  font-size: 12px;\n  text-transform: uppercase;\n  margin-bottom: 1em;\n`;\n\ninterface Props {\n  open: boolean;\n  handleClose: () => void;\n}\n\ninterface Props {\n  open: boolean;\n  handleClose: () => void;\n}\n\nconst AboutModal: React.FC<Props> = ({open, handleClose}) => {\n  return (\n    <Dialog open={open} onClose={handleClose}>\n      <DialogContent>\n        <CustomLabel>About</CustomLabel>\n        <DialogContentText>\n          This App uses <strong>WebRTC</strong> for secure end-to-end peer connection (you can{' '}\n          <Link href=\"https://test.webrtc.org/\" rel=\"noreferrer\" target=\"_blank\">\n            test here\n          </Link>\n          ), together with free STUN server from Google, and Firebase for signalling service and peer presence\n          management. Only the following data is used by Firebase for WebRTC signalling:\n          <ul>\n            <li>File metadata including file name, size and type</li>\n            <li>ICE candidate descriptions, offers and answers that contain SDP information.</li>\n            <li>Your public IP address is also used and served as the default room ID (in base64 encoded format). </li>\n          </ul>\n          You can also join another network room by entering their ID, or create custom ones from your own.\n        </DialogContentText>\n\n        <CustomLabel>Get Started</CustomLabel>\n        <DialogContentText>\n          Peers in the same network or room ID should appear in the app with their device and browser info, start\n          transfer file by drag and drop files or click their emoji to select files for transfer.\n        </DialogContentText>\n\n        <DialogContentText>\n          You can swipe right or click the drawer menu icon to see the app settings and your current room ID.\n        </DialogContentText>\n\n        <DialogContentText>\n          Maximum file size is set to <strong>{readableBytes(MAXIMUM_FILE_BYTE, 0)}</strong>, with up to{' '}\n          <strong>{MAXIMUM_FILE_NUMBER}</strong> file peer transfer and up to <strong>{MAXIMUM_PEER_NUMBER}</strong>{' '}\n          peers each room.\n        </DialogContentText>\n      </DialogContent>\n    </Dialog>\n  );\n};\n\nexport default AboutModal;\n","import React from 'react';\nimport styled from 'styled-components';\n\nimport clsx from 'clsx';\nimport Drawer from '@material-ui/core/Drawer';\nimport Divider from '@material-ui/core/Divider';\nimport IconButton from '@material-ui/core/IconButton';\nimport ArrowBackIcon from '@material-ui/icons/ArrowBack';\nimport Tooltip from '@material-ui/core/Tooltip';\nimport MenuIcon from '@material-ui/icons/Menu';\nimport useDrawerStyles from 'src/styles/hooks/useDrawerStyles';\n\nimport {AppSettingContext, IAppSettingContextVariable} from 'src/providers/AppSettingProvider';\nimport DrawerOptionList from 'src/components/SideDrawer/DrawerOptionList';\nimport JoinRoomModal from 'src/components/SideDrawer/Modals/JoinRoomModal';\nimport AboutModal from 'src/components/SideDrawer/Modals/AboutModal';\n\nconst StyledIconButton = styled(IconButton)`\n  width: ${(props) => props.theme.drawerMinWidth};\n  height: ${(props) => props.theme.drawerMinWidth};\n  color: ${(props) => props.theme.primary.contrastText} !important;\n`;\n\nconst StyledDrawer = styled(Drawer)`\n  .MuiDrawer-paper {\n    background-color: ${(props) => props.theme.primary.light} !important;\n    color: ${(props) => props.theme.primary.contrastText} !important;\n    overflow-x: hidden;\n  }\n`;\n\ninterface Props {\n  gestureDirection: 'left' | 'right' | undefined;\n}\n\ninterface ISideDrawer extends Props {\n  contextProps: IAppSettingContextVariable;\n}\n\nconst SideDrawer: React.FC<ISideDrawer> = ({gestureDirection, contextProps}) => {\n  const classes = useDrawerStyles();\n  const [drawerOpen, setDrawerOpen] = React.useState(false);\n  const [joinRoomModalOpen, setJoinRoomModalOpen] = React.useState(false);\n  const [aboutModalOpen, setAboutModalOpen] = React.useState(false);\n\n  React.useEffect(() => {\n    if (gestureDirection === 'left') setDrawerOpen(false);\n    if (gestureDirection === 'right') setDrawerOpen(true);\n    if (!gestureDirection) setDrawerOpen(false);\n  }, [gestureDirection]);\n\n  const handleToggle = () => setDrawerOpen((prev) => !prev);\n\n  const handleJoinRoomModalOpen = () => setJoinRoomModalOpen(true);\n\n  const handleAboutModalOpen = () => setAboutModalOpen(true);\n\n  return (\n    <StyledDrawer\n      variant=\"permanent\"\n      className={clsx(classes.drawer, {\n        [classes.drawerOpen]: drawerOpen,\n        [classes.drawerClose]: !drawerOpen,\n      })}\n      classes={{\n        paper: clsx({\n          [classes.drawerOpen]: drawerOpen,\n          [classes.drawerClose]: !drawerOpen,\n        }),\n      }}\n    >\n      <div className={classes.titleBar}>\n        {drawerOpen && <div className={classes.titleText}>PeerTransfer</div>}\n        <Tooltip title={drawerOpen ? 'Close Menu' : 'Open Menu'} placement=\"right\">\n          <StyledIconButton disableRipple onClick={handleToggle}>\n            {drawerOpen ? <ArrowBackIcon /> : <MenuIcon />}\n          </StyledIconButton>\n        </Tooltip>\n      </div>\n\n      <Divider />\n\n      <DrawerOptionList\n        drawerOpen={drawerOpen}\n        handleJoinRoomModalOpen={handleJoinRoomModalOpen}\n        handleAboutModalOpen={handleAboutModalOpen}\n        {...contextProps}\n      />\n\n      <JoinRoomModal open={joinRoomModalOpen} handleClose={() => setJoinRoomModalOpen(false)} />\n\n      <AboutModal open={aboutModalOpen} handleClose={() => setAboutModalOpen(false)} />\n    </StyledDrawer>\n  );\n};\n\nconst ConsumedSideDrawer = (props: Props) => (\n  <AppSettingContext.Consumer>\n    {(appSettingContext: IAppSettingContextVariable) => <SideDrawer {...props} contextProps={appSettingContext} />}\n  </AppSettingContext.Consumer>\n);\n\nexport default ConsumedSideDrawer;\n","import React, {useState, useEffect, useLayoutEffect} from 'react';\nimport firebase from 'src/services/firebase';\nimport styled from 'styled-components';\n\nimport getRandomFaceEmoji from 'src/utils/getRandomFaceEmoji';\nimport detectOS from 'src/utils/detectOS';\n\nimport {CircularProgress} from '@material-ui/core';\nimport backgroundRipple from 'src/assets/backgroundRipple.svg';\n\nimport {useGesture} from 'react-use-gesture';\nimport {IdentityContext, IIdentityContextVariable} from 'src/providers/IdentityProvider';\nimport PeersListener from 'src/components/PeersListener';\nimport SideDrawer from 'src/components/SideDrawer';\nimport {IPeerField} from 'src/types';\n\nimport {toast} from 'react-toastify';\nimport {DATA_CHANNEL_TIMEOUT, ELE_PUBLIC_ID, ELE_PUBLIC_ID_WRAPPER} from 'src/constants';\n\nconst Loader = styled(CircularProgress)``;\n\nconst RippleHolder = styled.div`\n  position: absolute;\n  bottom: 0;\n  background-image: url(${backgroundRipple});\n  background-repeat: no-repeat;\n  background-position: bottom;\n  background-size: cover;\n  width: 100%;\n  height: 100%;\n  max-height: 1600px;\n`;\n\nconst LoadingWrapper = styled.div`\n  position: relative;\n  background-color: ${(props) => props.theme.primary.main};\n  height: 100%;\n  min-height: 100%;\n  max-width: 100vw;\n  overflow-x: hidden;\n  overflow-y: hidden;\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  text-align: center;\n  justify-content: center;\n  font-size: calc(10px + 2vmin);\n  color: white;\n`;\n\nconst Wrapper = styled(LoadingWrapper)`\n  margin-left: ${(props) => props.theme.drawerMinWidth};\n  z-index: 10;\n  p,\n  button,\n  label {\n    z-index: 1;\n  }\n`;\n\ninterface Props {\n  localID: string;\n  publicID: string;\n}\n\nconst ConsumedIdentityLayout: React.FC<Props> = ({publicID, localID}) => {\n  const [selfIdentity, setSelfIdentity] = useState<IPeerField | null>();\n  const [gestureDirection, setGestureDirection] = useState<'left' | 'right' | undefined>();\n\n  useEffect(() => {\n    const initPeers = () => {\n      const presenceDB = firebase.database();\n      const identity = {\n        id: localID,\n        emoji: `${getRandomFaceEmoji()}`,\n        ...detectOS(),\n      } as IPeerField;\n\n      let presenceRef = presenceDB.ref(`${publicID}/${localID}`);\n\n      presenceRef.set(identity);\n      presenceRef.onDisconnect().remove();\n      setSelfIdentity(identity);\n    };\n\n    initPeers();\n  }, [localID, publicID]);\n\n  useLayoutEffect(() => {\n    if (sessionStorage.getItem(DATA_CHANNEL_TIMEOUT)) {\n      toast(\n        <div>\n          Failed to create a stable data channel, please try again\n          <br />\n          <sub>Note: data transfer between Apple and Windows devices currently not working</sub>\n        </div>,\n        {\n          autoClose: false,\n          type: 'warning',\n        },\n      );\n      sessionStorage.removeItem(DATA_CHANNEL_TIMEOUT);\n    }\n  }, []);\n\n  const bind = useGesture({\n    onDragEnd: (state) => {\n      if (\n        state.event.target === document.getElementById(ELE_PUBLIC_ID) ||\n        state.event.target === document.getElementById(ELE_PUBLIC_ID_WRAPPER)\n      )\n        return;\n      let movementX = Math.sign(state.movement[0]);\n      let movementY = Math.sign(state.movement[1]);\n      let distanceX = Math.abs(state.movement[0]);\n      if (distanceX > 8) {\n        if (movementX === -1) setGestureDirection('left');\n        if (movementX === 1) setGestureDirection('right');\n      }\n      if (movementX === 0 && movementY === 0) setGestureDirection(undefined);\n    },\n  });\n\n  return (\n    <Wrapper {...bind()}>\n      <SideDrawer gestureDirection={gestureDirection} />\n      <PeersListener selfIdentity={selfIdentity} publicID={publicID} localID={localID} />\n      <RippleHolder />\n    </Wrapper>\n  );\n};\n\nconst IdentityLayout = () => (\n  <IdentityContext.Consumer>\n    {({localID, publicID}: IIdentityContextVariable) =>\n      localID && publicID ? (\n        <ConsumedIdentityLayout localID={localID} publicID={publicID} />\n      ) : (\n        <LoadingWrapper>\n          <Loader color=\"secondary\" />\n        </LoadingWrapper>\n      )\n    }\n  </IdentityContext.Consumer>\n);\n\nexport default IdentityLayout;\n","import styled from 'styled-components';\nimport {ToastContainer, ToastContainerProps} from 'react-toastify';\n\nexport const WrappedToastContainer = ({className, ...rest}: ToastContainerProps & {className?: string}) => (\n  <div className={className}>\n    <ToastContainer {...rest} />\n  </div>\n);\n\n// https://fkhadra.github.io/react-toastify/how-to-style\nexport default styled(WrappedToastContainer).attrs({\n  // custom props\n})`\n  .Toastify__toast-container {\n    width: max-content;\n    max-width: 80vw;\n  }\n  .Toastify__toast-body {\n    font-family: 'Roboto', sans-serif;\n    white-space: pre-line;\n    min-width: 200px;\n  }\n`;\n","import React from 'react';\nimport IdentityLayout from 'src/IdentityLayout';\nimport IdentityProvider from 'src/providers/IdentityProvider';\nimport AppSettingProvider, {AppSettingContext, IAppSettingContextVariable} from 'src/providers/AppSettingProvider';\nimport StyledToastContainer from 'src/styles/styled-components/StyledToastContainer';\nimport theme, {brightnessTheme} from 'src/styles/theme';\nimport {ThemeProvider} from 'styled-components';\nimport MuiThemeProvider from '@material-ui/styles/ThemeProvider';\nimport {createTheme} from '@material-ui/core/styles';\n\nimport 'src/App.css';\nimport 'react-toastify/dist/ReactToastify.css';\n\ninterface Props {\n  appTheme: 'light' | 'dark';\n}\n\nconst AppContent: React.FC<Props> = ({appTheme}) => {\n  const MuiAppTheme = createTheme({\n    palette: {\n      primary: {\n        main: brightnessTheme[appTheme].primary.main,\n        dark: brightnessTheme[appTheme].primary.dark,\n      },\n      secondary: {main: brightnessTheme[appTheme].secondary.main},\n    },\n  });\n\n  return (\n    <ThemeProvider\n      theme={{\n        ...theme,\n        ...brightnessTheme[appTheme],\n      }}\n    >\n      <MuiThemeProvider theme={MuiAppTheme}>\n        <IdentityLayout />\n        <StyledToastContainer\n          position=\"top-right\"\n          autoClose={5000}\n          pauseOnFocusLoss={false}\n          newestOnTop={false}\n          closeOnClick\n          hideProgressBar\n          rtl={false}\n          draggable\n        />\n      </MuiThemeProvider>\n    </ThemeProvider>\n  );\n};\n\nconst App = () => (\n  <IdentityProvider>\n    <AppSettingProvider>\n      <AppSettingContext.Consumer>\n        {({appTheme}: IAppSettingContextVariable) => <AppContent appTheme={appTheme} />}\n      </AppSettingContext.Consumer>\n    </AppSettingProvider>\n  </IdentityProvider>\n);\n\nexport default App;\n","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read https://cra.link/PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.0/8 are considered localhost for IPv4.\n    window.location.hostname.match(/^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/),\n);\n\ntype Config = {\n  onSuccess?: (registration: ServiceWorkerRegistration) => void;\n  onUpdate?: (registration: ServiceWorkerRegistration) => void;\n};\n\nexport function register(config?: Config) {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(process.env.PUBLIC_URL, window.location.href);\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n              'worker. To learn more, visit https://cra.link/PWA',\n          );\n        });\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl: string, config?: Config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then((registration) => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker == null) {\n          return;\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                'New content is available and will be used when all ' +\n                  'tabs for this page are closed. See https://cra.link/PWA.',\n              );\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration);\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.');\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration);\n              }\n            }\n          }\n        };\n      };\n    })\n    .catch((error) => {\n      console.error('Error during service worker registration:', error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl: string, config?: Config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl, {\n    headers: {'Service-Worker': 'script'},\n  })\n    .then((response) => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get('content-type');\n      if (response.status === 404 || (contentType != null && contentType.indexOf('javascript') === -1)) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then((registration) => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {\n      console.log('No internet connection found. App is running in offline mode.');\n    });\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready\n      .then((registration) => {\n        registration.unregister();\n      })\n      .catch((error) => {\n        console.error(error.message);\n      });\n  }\n}\n","import {ReportHandler} from 'web-vitals';\n\nconst reportWebVitals = (onPerfEntry?: ReportHandler) => {\n  if (onPerfEntry && onPerfEntry instanceof Function) {\n    import('web-vitals').then(({getCLS, getFID, getFCP, getLCP, getTTFB}) => {\n      getCLS(onPerfEntry);\n      getFID(onPerfEntry);\n      getFCP(onPerfEntry);\n      getLCP(onPerfEntry);\n      getTTFB(onPerfEntry);\n    });\n  }\n};\n\nexport default reportWebVitals;\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\nimport * as serviceWorkerRegistration from './serviceWorkerRegistration';\nimport reportWebVitals from './reportWebVitals';\n\nReactDOM.render(\n  <React.StrictMode>\n    <App />\n  </React.StrictMode>,\n  document.getElementById('root'),\n);\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: https://cra.link/PWA\nserviceWorkerRegistration.unregister();\n\n// If you want to start measuring performance in your app, pass a function\n// to log results (for example: reportWebVitals(console.log))\n// or send to an analytics endpoint. Learn more: https://bit.ly/CRA-vitals\nreportWebVitals();\n"],"sourceRoot":""}